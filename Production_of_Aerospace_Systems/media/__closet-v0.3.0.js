var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};function t(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e,t){var r,n,o,u,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function s(u){return function(s){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],n=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,u=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=u.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=u.return)&&r.call(u)}finally{if(o)throw o.error}}return i}function i(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}var s=[0,3,0],a=[],c="v"+s.join(".")+(a.length>0?"-"+a.join("."):"");function l(e,t){if(0===t.length)return e;for(var r=u(t),n=r[0],o=n.sep,i=n.max,s=n.trim,a=n.keepEmpty,c=r.slice(1),p=[],f=e,h=!1;!h;){var d=f.indexOf(o),m=u(d<0||p.length+1===i?[f,"",!0]:[f.slice(0,d),f.slice(d+o.length),!1],3),v=m[0],y=m[1],g=m[2],b=s?v.trim():v;(a||b.length>=1)&&p.push(b),f=y,h=g}return p.map((function(e){return l(e,c)}))}var p,f=function(e){var t,r,n,o;return"string"==typeof e?{sep:e,max:1/0,trim:!1,keepEmpty:!0}:{sep:null!==(t=e.sep)&&void 0!==t?t:"::",max:null!==(r=e.max)&&void 0!==r?r:1/0,trim:null!==(n=e.trim)&&void 0!==n&&n,keepEmpty:null===(o=e.keepEmpty)||void 0===o||o}};!function(e){e[e.Ready=0]="Ready",e[e.NotReady=1]="NotReady",e[e.ContainsTags=2]="ContainsTags",e[e.ContinueTags=3]="ContinueTags"}(p||(p={}));var h=function(e,t){return e&&t.isReady()},d=function(){function e(e,t,r,n,o,u,i){this._separators=[],this.fullKey=e,this.key=t,this.num=r,this.fullOccur=n,this.occur=o,this.delimiters=u,this.innerNodes=i}return Object.defineProperty(e.prototype,"representation",{get:function(){return this.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"valuesText",{get:function(){return this.innerNodes.map((function(e){return e.toString()})).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){return l(this.valuesText,this._separators)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"separators",{set:function(e){this._separators=e.map(f)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"separator",{get:function(){return this.separators},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return""+this.delimiters.open+this.fullKey+this.delimiters.sep+this.valuesText+this.delimiters.close},e.prototype.isReady=function(){return!1},e.prototype.evaluate=function(e,t,r){var n,o=t(this.key),u=r.length-1,s=o.getOptions().capture,a=function(n,o){return n.evaluate(e,t,i(r,[o]))};s||(n=this.innerNodes).splice.apply(n,i([0,this.innerNodes.length],this.innerNodes.flatMap(a)));var c=this.innerNodes.reduce(h,!0);this.separators=o.getOptions().separators;var l={path:r,depth:u,ready:c,capture:s},f=o.execute(this,l);switch(f.status){case p.NotReady:return[this];case p.Ready:return[new m(f.result)];case p.ContainsTags:return e.rawParse(f.result);case p.ContinueTags:return e.rawParse(f.result).flatMap(a)}},e}(),m=function(){function e(e){this.text=e}return e.prototype.toString=function(){return this.text},e.prototype.isReady=function(){return!0},e.prototype.evaluate=function(){return[this]},e}(),v=function(){function e(){}return e.prototype.toString=function(){return null},e.prototype.isReady=function(){return!0},e.prototype.evaluate=function(){return[this]},e}(),y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function g(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}var b=g((function(e){var t,r;t=y,r=function(){function e(t,r,n){return this.id=++e.highestId,this.name=t,this.symbols=r,this.postprocess=n,this}function t(e,t,r,n){this.rule=e,this.dot=t,this.reference=r,this.data=[],this.wantedBy=n,this.isComplete=this.dot===e.symbols.length}function r(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function n(e,t){this.rules=e,this.start=t||this.rules[0].name;var r=this.byName={};this.rules.forEach((function(e){r.hasOwnProperty(e.name)||(r[e.name]=[]),r[e.name].push(e)}))}function o(){this.reset("")}function u(e,t,u){if(e instanceof n){var i=e;u=t}else i=n.fromCompiled(e,t);for(var s in this.grammar=i,this.options={keepHistory:!1,lexer:i.lexer||new o},u||{})this.options[s]=u[s];this.lexer=this.options.lexer,this.lexerState=void 0;var a=new r(i,0);this.table=[a],a.wants[i.start]=[],a.predict(i.start),a.process(),this.current=0}function i(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return e.toString();if(e.type)return"%"+e.type;if(e.test)return"<"+String(e.test)+">";throw new Error("Unknown symbol type: "+e)}}return e.highestId=0,e.prototype.toString=function(e){var t=void 0===e?this.symbols.map(i).join(" "):this.symbols.slice(0,e).map(i).join(" ")+" ● "+this.symbols.slice(e).map(i).join(" ");return this.name+" → "+t},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var r=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return r.left=this,r.right=e,r.isComplete&&(r.data=r.build(),r.right=void 0),r},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,u.fail))},r.prototype.process=function(e){for(var t=this.states,r=this.wants,n=this.completed,o=0;o<t.length;o++){var i=t[o];if(i.isComplete){if(i.finish(),i.data!==u.fail){for(var s=i.wantedBy,a=s.length;a--;){var c=s[a];this.complete(c,i)}if(i.reference===this.index){var l=i.rule.name;(this.completed[l]=this.completed[l]||[]).push(i)}}}else{if("string"!=typeof(l=i.rule.symbols[i.dot])){this.scannable.push(i);continue}if(r[l]){if(r[l].push(i),n.hasOwnProperty(l)){var p=n[l];for(a=0;a<p.length;a++){var f=p[a];this.complete(i,f)}}}else r[l]=[i],this.predict(l)}}},r.prototype.predict=function(e){for(var r=this.grammar.byName[e]||[],n=0;n<r.length;n++){var o=r[n],u=this.wants[e],i=new t(o,0,this.index,u);this.states.push(i)}},r.prototype.complete=function(e,t){var r=e.nextState(t);this.states.push(r)},n.fromCompiled=function(t,r){var o=t.Lexer;t.ParserStart&&(r=t.ParserStart,t=t.ParserRules);var u=new n(t=t.map((function(t){return new e(t.name,t.symbols,t.postprocess)})),r);return u.lexer=o,u},o.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},o.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},o.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},o.prototype.formatError=function(e,t){var r=this.buffer;if("string"==typeof r){var n=r.split("\n").slice(Math.max(0,this.line-5),this.line),o=r.indexOf("\n",this.index);-1===o&&(o=r.length);var u=this.index-this.lastLineBreak,i=String(this.line).length;return t+=" at line "+this.line+" col "+u+":\n\n",t+=n.map((function(e,t){return s(this.line-n.length+t+1,i)+" "+e}),this).join("\n"),t+="\n"+s("",i+u)+"^\n"}return t+" at index "+(this.index-1);function s(e,t){var r=String(e);return Array(t-r.length+1).join(" ")+r}},u.fail={},u.prototype.feed=function(e){var t,n=this.lexer;for(n.reset(e,this.lexerState);;){try{if(!(t=n.next()))break}catch(e){var u=new r(this.grammar,this.current+1);throw this.table.push(u),(a=new Error(this.reportLexerError(e))).offset=this.current,a.token=e.token,a}var i=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var s=this.current+1;u=new r(this.grammar,s),this.table.push(u);for(var a,c=void 0!==t.text?t.text:t.value,l=n.constructor===o?t.value:t,p=i.scannable,f=p.length;f--;){var h=p[f],d=h.rule.symbols[h.dot];if(d.test?d.test(l):d.type?d.type===t.type:d.literal===c){var m=h.nextState({data:l,token:t,isToken:!0,reference:s-1});u.states.push(m)}}if(u.process(),0===u.states.length)throw(a=new Error(this.reportError(t))).offset=this.current,a.token=t,a;this.options.keepHistory&&(i.lexerState=n.save()),this.current++}return i&&(this.lexerState=n.save()),this.results=this.finish(),this},u.prototype.reportLexerError=function(e){var t,r,n=e.token;return n?(t="input "+JSON.stringify(n.text[0])+" (lexer error)",r=this.lexer.formatError(n,"Syntax error")):(t="input (lexer error)",r=e.message),this.reportErrorCommon(r,t)},u.prototype.reportError=function(e){var t=(e.type?e.type+" token: ":"")+JSON.stringify(void 0!==e.value?e.value:e),r=this.lexer.formatError(e,"Syntax error");return this.reportErrorCommon(r,t)},u.prototype.reportErrorCommon=function(e,t){var r=[];r.push(e);var n=this.table.length-2,o=this.table[n],u=o.states.filter((function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t}));return 0===u.length?(r.push("Unexpected "+t+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(o.states,r)):(r.push("Unexpected "+t+". Instead, I was expecting to see one of the following:\n"),u.map((function(e){return this.buildFirstStateStack(e,[])||[e]}),this).forEach((function(e){var t=e[0],n=t.rule.symbols[t.dot],o=this.getSymbolDisplay(n);r.push("A "+o+" based on:"),this.displayStateStack(e,r)}),this)),r.push(""),r.join("\n")},u.prototype.displayStateStack=function(e,t){for(var r,n=0,o=0;o<e.length;o++){var u=e[o],i=u.rule.toString(u.dot);i===r?n++:(n>0&&t.push("    ^ "+n+" more lines identical to this"),n=0,t.push("    "+i)),r=i}},u.prototype.getSymbolDisplay=function(e){return function(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return"character matching "+e;if(e.type)return e.type+" token";if(e.test)return"token matching "+String(e.test);throw new Error("Unknown symbol type: "+e)}}(e)},u.prototype.buildFirstStateStack=function(e,t){if(-1!==t.indexOf(e))return null;if(0===e.wantedBy.length)return[e];var r=e.wantedBy[0],n=[e].concat(t),o=this.buildFirstStateStack(r,n);return null===o?null:[e].concat(o)},u.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},u.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},u.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},u.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(r){r.rule.name===t&&r.dot===r.rule.symbols.length&&0===r.reference&&r.data!==u.fail&&e.push(r)})),e.map((function(e){return e.data}))},{Parser:u,Grammar:n,Rule:e}},e.exports?e.exports=r():t.nearley=r()})),x=/^((?:[a-zA-Z_/]|%\w)+)(\d*)(?::(\d+))?$/u,A=function(e,t){var r,n=(null!==(r=e.get(t))&&void 0!==r?r:-1)+1;return e.set(t,n),n},w=new(function(){function e(){this.tagCounter=null,this.tagCounterFull=null,this.delimiters=null}return e.prototype.increment=function(e,t){return[A(this.tagCounterFull,e),A(this.tagCounter,t)]},e.prototype.build=function(e,t){var r=e.match(x);if(!r)throw new Error("Could not match key. This should never happen.");var n=r[1],o=r[2].length>0?Number(r[2]):null,i=u(this.increment(e,n),2),s=i[0],a=i[1];return new d(e,n,o,s,a,this.delimiters,t)},e.prototype.push=function(e,t){this.tagCounterFull=e[0],this.tagCounter=e[1],this.delimiters=t},e}());function E(e){return e[0]}var F=function(e){return{Lexer:e,ParserRules:[{name:"start",symbols:["content"],postprocess:E},{name:"content$ebnf$1",symbols:[]},{name:"content$ebnf$1",symbols:["content$ebnf$1","node"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"content",symbols:["content$ebnf$1"],postprocess:E},{name:"node",symbols:["text"],postprocess:E},{name:"node",symbols:["tag"],postprocess:E},{name:"text",symbols:[e.has("text")?{type:"text"}:text],postprocess:function(e){var t=u(e,1)[0];return new m(t.value)}},{name:"tag",symbols:[e.has("tagopen")?{type:"tagopen"}:tagopen,e.has("keyname")?{type:"keyname"}:keyname,"inner",e.has("tagclose")?{type:"tagclose"}:tagclose],postprocess:function(e){var t=u(e,3),r=t[1],n=t[2];return w.build(r.value,n)}},{name:"inner$ebnf$1$subexpression$1",symbols:[e.has("sep")?{type:"sep"}:sep,"content"]},{name:"inner$ebnf$1",symbols:["inner$ebnf$1$subexpression$1"],postprocess:E},{name:"inner$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"inner",symbols:["inner$ebnf$1"],postprocess:function(e){var t=u(e,1)[0];return t?t[1]:[]}}],ParserStart:"start"}};var k,S=g((function(e){var t,r;t=y,r=function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,r="boolean"==typeof(new RegExp).sticky;function n(e){return e&&"[object RegExp]"===t.call(e)}function o(e){return e&&"object"==typeof e&&!n(e)&&!Array.isArray(e)}function u(e){return"("+e+")"}function i(e){return e.length?"(?:"+e.map((function(e){return"(?:"+e+")"})).join("|")+")":"(?!)"}function s(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(n(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function a(t,r){if(o(r)||(r={match:r}),r.include)throw new Error("Matching rules cannot also include states");var u={defaultType:t,lineBreaks:!!r.error||!!r.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var i in r)e.call(r,i)&&(u[i]=r[i]);if("string"==typeof u.type&&t!==u.type)throw new Error("Type transform cannot be a string (type '"+u.type+"' for token '"+t+"')");var s=u.match;return u.match=Array.isArray(s)?s:s?[s]:[],u.match.sort((function(e,t){return n(e)&&n(t)?0:n(t)?-1:n(e)?1:t.length-e.length})),u}function c(e){return Array.isArray(e)?function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(n.include)for(var o=[].concat(n.include),u=0;u<o.length;u++)t.push({include:o[u]});else{if(!n.type)throw new Error("Rule has no type: "+JSON.stringify(n));t.push(a(n.type,n))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),r=[],n=0;n<t.length;n++){var u=t[n],i=e[u],s=[].concat(i);if("include"!==u){var c=[];s.forEach((function(e){o(e)?(c.length&&r.push(a(u,c)),r.push(a(u,e)),c=[]):c.push(e)})),c.length&&r.push(a(u,c))}else for(var l=0;l<s.length;l++)r.push({include:s[l]})}return r}(e)}var l=a("error",{lineBreaks:!0,shouldThrow:!0});function p(e,t){for(var o=null,a=Object.create(null),c=!0,p=null,f=[],h=[],d=0;d<e.length;d++)e[d].fallback&&(c=!1);for(d=0;d<e.length;d++){var m=e[d];if(m.include)throw new Error("Inheritance is not allowed in stateless lexers");if(m.error||m.fallback){if(o)throw!m.fallback==!o.fallback?new Error("Multiple "+(m.fallback?"fallback":"error")+" rules not allowed (for token '"+m.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+m.defaultType+"')");o=m}var v=m.match.slice();if(c)for(;v.length&&"string"==typeof v[0]&&1===v[0].length;)a[v.shift().charCodeAt(0)]=m;if(m.pop||m.push||m.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+m.defaultType+"')");if(m.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+m.defaultType+"')")}if(0!==v.length){c=!1,f.push(m);for(var y=0;y<v.length;y++){var g=v[y];if(n(g))if(null===p)p=g.unicode;else if(p!==g.unicode&&!1===m.fallback)throw new Error("If one rule is /u then all must be")}var b=i(v.map(s)),x=new RegExp(b);if(x.test(""))throw new Error("RegExp matches empty string: "+x);if(new RegExp("|"+b).exec("").length-1>0)throw new Error("RegExp has capture groups: "+x+"\nUse (?: … ) instead");if(!m.lineBreaks&&x.test("\n"))throw new Error("Rule should declare lineBreaks: "+x);h.push(u(b))}}var A=o&&o.fallback,w=r&&!A?"ym":"gm",E=r||A?"":"|";return!0===p&&(w+="u"),{regexp:new RegExp(i(h)+E,w),groups:f,fast:a,error:o||l}}function f(e,t,r){var n=e&&(e.push||e.next);if(n&&!r[n])throw new Error("Missing state '"+n+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!=+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var h=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};h.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},h.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},h.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},h.prototype.popState=function(){this.setState(this.stack.pop())},h.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var d=r?function(e,t){return e.exec(t)}:function(e,t){var r=e.exec(t);return 0===r[0].length?null:r};function m(){return this.value}if(h.prototype._getGroup=function(e){for(var t=this.groups.length,r=0;r<t;r++)if(void 0!==e[r+1])return this.groups[r];throw new Error("Cannot find token type for matched text")},h.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var r=this.buffer;if(e!==r.length){if(i=this.fast[r.charCodeAt(e)])return this._token(i,r.charAt(e),e);var n=this.re;n.lastIndex=e;var o=d(n,r),u=this.error;if(null==o)return this._token(u,r.slice(e,r.length),e);var i=this._getGroup(o),s=o[0];return u.fallback&&o.index!==e?(this.queuedGroup=i,this.queuedText=s,this._token(u,r.slice(e,o.index),e)):this._token(i,s,e)}},h.prototype._token=function(e,t,r){var n=0;if(e.lineBreaks){var o=/\n/g,u=1;if("\n"===t)n=1;else for(;o.exec(t);)n++,u=o.lastIndex}var i={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:m,offset:r,lineBreaks:n,line:this.line,col:this.col},s=t.length;if(this.index+=s,this.line+=n,0!==n?this.col=s-u+1:this.col+=s,e.shouldThrow)throw new Error(this.formatError(i,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),i},"undefined"!=typeof Symbol&&Symbol.iterator){var v=function(e){this.lexer=e};v.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},v.prototype[Symbol.iterator]=function(){return this},h.prototype[Symbol.iterator]=function(){return new v(this)}}return h.prototype.formatError=function(e,t){if(null==e){var r=this.buffer.slice(this.index);e={text:r,offset:this.index,lineBreaks:-1===r.indexOf("\n")?0:1,line:this.line,col:this.col}}var n=Math.max(0,e.offset-e.col+1),o=e.lineBreaks?e.text.indexOf("\n"):e.text.length,u=this.buffer.substring(n,e.offset+o);return t+=" at line "+e.line+" col "+e.col+":\n\n",t+="  "+u+"\n",t+="  "+Array(e.col).join(" ")+"^"},h.prototype.clone=function(){return new h(this.states,this.state)},h.prototype.has=function(e){return!0},{compile:function(e){var t=p(c(e));return new h({start:t},"start")},states:function(e,t){var r=e.$all?c(e.$all):[];delete e.$all;var n=Object.getOwnPropertyNames(e);t||(t=n[0]);for(var o=Object.create(null),u=0;u<n.length;u++)o[b=n[u]]=c(e[b]).concat(r);for(u=0;u<n.length;u++)for(var i=o[b=n[u]],s=Object.create(null),a=0;a<i.length;a++){var l=i[a];if(l.include){var d=[a,1];if(l.include!==b&&!s[l.include]){s[l.include]=!0;var m=o[l.include];if(!m)throw new Error("Cannot include nonexistent state '"+l.include+"' (in state '"+b+"')");for(var v=0;v<m.length;v++){var y=m[v];-1===i.indexOf(y)&&d.push(y)}}i.splice.apply(i,d),a--}}var g=Object.create(null);for(u=0;u<n.length;u++){var b;g[b=n[u]]=p(o[b],!0)}for(u=0;u<n.length;u++){var x=n[u],A=g[x],w=A.groups;for(a=0;a<w.length;a++)f(w[a],x,g);var E=Object.getOwnPropertyNames(A.fast);for(a=0;a<E.length;a++)f(A.fast[E[a]],x,g)}return new h(g,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t=Object.create(null),r=Object.create(null),n=Object.getOwnPropertyNames(e),o=0;o<n.length;o++){var u=n[o],i=e[u];(Array.isArray(i)?i:[i]).forEach((function(e){if((r[e.length]=r[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+u+"')");t[e]=u}))}function s(e){return JSON.stringify(e)}var a="";for(var c in a+="switch (value.length) {\n",r){var l=r[c];a+="case "+c+":\n",a+="switch (value) {\n",l.forEach((function(e){var r=t[e];a+="case "+s(e)+": return "+s(r)+"\n"})),a+="}\n"}return a+="}\n",Function("value",a)}}},e.exports?e.exports=r():t.moo=r()})),C=/(?:[a-zA-Z_/]|%\w)+\d*/u,B=function(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")},D=function(e){var t=new RegExp("[\\s\\S]+?(?="+B(e.open)+"|$)","u"),r=new RegExp("[\\s\\S]+?(?="+B(e.open)+"|"+B(e.close)+")","u");return S.states({main:{tagopen:{match:e.open,push:"key"},text:{match:t,lineBreaks:!0}},key:{keyname:{match:C},sep:{match:e.sep,next:"intag"},tagclose:{match:e.close,pop:1}},intag:{tagopen:{match:e.open,push:"key"},tagclose:{match:e.close,pop:1},text:{match:r,lineBreaks:!0}}})},N={open:"[[",sep:"::",close:"]]"},$=function(e,t){var r=function(e,t){var r=new b.Parser(t);try{return r.feed(e).results}catch(t){return console.log("Will default to Trivial Base Tag, due to error parsing text:",t),[[new m(e)]]}}(e,t);return r.length>1&&console.log("Ambiguous template grammar"),r[0]},I=function(e,t){return i(function(e,t){var r,u,i,s,a,c,l,p,f,h,d,m;return n(this,(function(n){switch(n.label){case 0:r=!0,n.label=1;case 1:n.trys.push([1,14,15,16]),u=o(e),i=u.next(),n.label=2;case 2:return i.done?[3,13]:(s=i.value,r?(r=!1,[3,5]):[3,3]);case 3:return[4,t];case 4:n.sent(),n.label=5;case 5:n.trys.push([5,10,11,12]),d=void 0,a=o(s),c=a.next(),n.label=6;case 6:return c.done?[3,9]:[4,c.value];case 7:n.sent(),n.label=8;case 8:return c=a.next(),[3,6];case 9:return[3,12];case 10:return l=n.sent(),d={error:l},[3,12];case 11:try{c&&!c.done&&(m=a.return)&&m.call(a)}finally{if(d)throw d.error}return[7];case 12:return i=u.next(),[3,2];case 13:return[3,16];case 14:return p=n.sent(),f={error:p},[3,16];case 15:try{i&&!i.done&&(h=u.return)&&h.call(u)}finally{if(f)throw f.error}return[7];case 16:return[2]}}))}(e.map((function(e){return $(e,t)})),new v))};!function(e){e[e.Single=1]="Single",e[e.Fragments=2]="Fragments"}(k||(k={}));var O=function(){function e(e){this.tagBuilderSettings=[new Map,new Map],this.delimiters=null!=e?e:N,this.lexer=D(this.delimiters),this.grammar=b.Grammar.fromCompiled(F(this.lexer))}return e.prototype.update=function(e){this.delimiters=null!=e?e:N,this.lexer=D(this.delimiters),this.grammar=b.Grammar.fromCompiled(F(this.lexer))},e.prototype.parse=function(e){return w.push(this.tagBuilderSettings,this.delimiters),I(e,this.grammar)},e.prototype.rawParse=function(e){return w.push(this.tagBuilderSettings,this.delimiters),$(e,this.grammar)},e}(),T=function(){function e(e,t,r){this.textFragments=e,this.parser=new O(r),this.nodes=null!=t?t:this.parser.parse(e)}return e.make=function(t,r){return new e([t],null,r)},e.makeFromFragments=function(t,r){return new e(t,null,r)},e.prototype.render=function(e,t){var r=this;void 0===t&&(t=function(){});for(var n={template:this,parser:this.parser},u=this.nodes,i=!1,s=function(t){var o={iteration:t},s=e.makeAccessor(n,o);u=u.flatMap((function(e,t){return e.evaluate(r.parser,s,[t])})),i=u.reduce(h,!0),e.finishIteration(n,o)},a=0;a<50&&!i;a++)s(a);var c=function(e){var t,r,n=[];if(0===e.length)return n;var u="";try{for(var i=o(e),s=i.next();!s.done;s=i.next()){var a=s.value.toString();"string"==typeof a?u+=a:(n.push(u),u="")}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n.push(u),n}(u);return t(c),e.finishRun(n,{result:c}),c},e}(),j=function(e,t,r){return e<0?r+e+1:t+e},_=function(e,t){var r;if("string"==typeof e)return e;var n=null;switch(e.nodeType){case Node.TEXT_NODE:return null!==(r=e.textContent)&&void 0!==r?r:"";case Node.ELEMENT_NODE:return n=e,t?n.outerHTML:n.innerHTML;case L.CHILD_NODE_SPAN:return e.spanAsStrings().join("");default:return""}},P={type:"index",value:0},M={type:"index",value:-1},L=function(){function e(t,r,n){var o,u,i,s;void 0===r&&(r=P),void 0===n&&(n=M),this.nodeType=e.CHILD_NODE_SPAN,this.parentElement=t,this.childNodes=Array.from(this.parentElement.childNodes),this.max=t.childNodes.length-1;var a=this.getFromMethod(r.type),c=this.getToMethod(n.type);this._fromIndex=a.call(this,r.value,null!==(o=r.startAtIndex)&&void 0!==o?o:0,null!==(u=r.exclusive)&&void 0!==u&&u),this._toIndex=c.call(this,n.value,Math.max(null!==(i=n.startAtIndex)&&void 0!==i?i:0,this.from),null!==(s=n.exclusive)&&void 0!==s&&s)}return Object.defineProperty(e.prototype,"from",{get:function(){return this._fromIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"to",{get:function(){return this._toIndex},enumerable:!1,configurable:!0}),e.prototype.getFromMethod=function(e){return"index"===e?this.fromIndex:"node"===e?this.fromNode:this.fromPredicate},e.prototype.getToMethod=function(e){return"index"===e?this.toIndex:"node"===e?this.toNode:this.toPredicate},e.prototype.fromSafe=function(e,t){return e<t||e>this.max?this.max:e},e.prototype.fromIndex=function(e,t,r){var n=j(e,t,this.max)+(r?1:0);return this.fromSafe(n,t)},e.prototype.fromNode=function(e,t,r){var n=this.childNodes.slice(t).findIndex((function(t){return t===e}))+t+(r?1:0);return this.fromSafe(n,t)},e.prototype.fromPredicate=function(e,t,r){var n=this.childNodes.slice(t).findIndex(e)+t+(r?1:0);return this.fromSafe(n,t)},e.prototype.toSafe=function(e,t){return e<t||e>this.max?0:e},e.prototype.toIndex=function(e,t,r){var n=j(e,t,this.max)-(r?1:0);return this.toSafe(n,t)},e.prototype.toNode=function(e,t,r){var n=this.childNodes.slice(t).findIndex((function(t){return t===e}))+t-(r?1:0);return this.toSafe(n,t)},e.prototype.toPredicate=function(e,t,r){var n=this.childNodes.slice(t).findIndex(e)+t-(r?1:0);return this.toSafe(n,t)},Object.defineProperty(e.prototype,"valid",{get:function(){return this._fromIndex<=this._toIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return Math.max(0,this._toIndex-this._fromIndex+1)},enumerable:!1,configurable:!0}),e.prototype.span=function(){return this.valid?this.childNodes.slice(this._fromIndex,this._toIndex+1):[]},e.prototype.spanAsStrings=function(){return this.span().map((function(e){return _(e,!0)}))},e.prototype.replaceSpan=function(e){var t,r;if(this.valid){var n=document.createElement("div"),u=this.parentElement.childNodes.length;this.parentElement.insertBefore(n,this.parentElement.childNodes[this._fromIndex]);try{for(var i=o(this.span()),s=i.next();!s.done;s=i.next()){var a=s.value;this.parentElement.removeChild(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}n.outerHTML=e,this.childNodes=Array.from(this.parentElement.childNodes),this.max=this.childNodes.length,this._toIndex=this._toIndex+(this.max-u)}},e.CHILD_NODE_SPAN=3353,e}(),z=function(e,t){return void 0===t&&(t=0),[{type:"predicate",value:e.value,startAtIndex:t,exclusive:!1},{type:"predicate",value:function(t){return!e.value(t)},startAtIndex:t,exclusive:!0}]},G=function(e){function r(t,r,n,o){var u=e.call(this,t,r,o)||this;return u.inputs=n,u}return t(r,e),r.prototype.renderToNodes=function(t){var r=this;e.prototype.render.call(this,t,(function(e){return e.forEach((function(e,t){return function(e,t){if("string"!=typeof e){var r=null,n=null;switch(e.nodeType){case Node.TEXT_NODE:r=e,n=document.createElement("div"),r.parentElement&&(r.parentElement.insertBefore(n,r),r.parentElement.removeChild(r)),n.outerHTML=t;break;case Node.ELEMENT_NODE:e.innerHTML=t;break;case L.CHILD_NODE_SPAN:e.replaceSpan(t)}}}(r.inputs[t],e)}))}))},r.makeFromNode=function(e,t){return new r([_(e,!1)],null,[e],t)},r.makeFromNodes=function(e,t){return new r(e.map((function(e){return _(e,!1)})),null,e,t)},r}(T),R=function(){var e,t;try{for(var r=o(Array.from(document.getElementsByClassName("closet-delay"))),n=r.next();!n.done;n=r.next()){n.value.style.visibility="visible"}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},q=function(){function e(e,t){this.filters=e,this.options=t}return e.prototype.register=function(e,t,r){void 0===r&&(r={}),this.filters.register(e,t),this.options.set(e,r)},e.prototype.getOptions=function(e){return this.options.get(e,{})},e}(),H=function(){function e(e,t,r,n,o,u,i,s){this.preset=e,this.filters=t,this.options=r,this.registrar=new q(t,r),this.deferred=n,this.aftermath=o,this.cache=u,this.memory=i,this.environment=s}return e.prototype.getBaseInternals=function(e){return Object.assign({},{filters:this.filters,options:this.options,registrar:this.registrar,cache:this.cache,memory:this.memory,environment:this.environment,deferred:this.deferred,aftermath:this.aftermath,preset:this.preset},e)},e.prototype.getAftermathInternals=function(e,t){return Object.assign(this.getBaseInternals(e),t)},e.prototype.getDeferredInternals=function(e,t){return Object.assign(this.getBaseInternals(e),t)},e.prototype.getInternals=function(e,t,r){return Object.assign(this.getDeferredInternals(e,t),r)},e.prototype.filterAccessor=function(e,t){var r=this;return{getProcessor:function(n){return{execute:function(o,u){return r.filters.execute(n,o,r.getInternals(e,t,u))},getOptions:function(){return r.options.get(n,{})}}}}},e.prototype.executeDeferred=function(e,t){var r=this.getDeferredInternals(e,t);this.deferred.executeEach(r)},e.prototype.executeAftermath=function(e,t){var r=this.getAftermathInternals(e,t);this.aftermath.executeEach(r)},e.prototype.switchPreset=function(e){this.preset=e},e.prototype.clear=function(){this.memory.clear(),this.aftermath.clear()},e.prototype.reset=function(){this.cache.clear(),this.deferred.clear()},e.prototype.install=function(){for(var e,t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{for(var u=o(r),i=u.next();!i.done;i=u.next()){var s=i.value;s(this.registrar)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}},e}(),J=function(e,t){return{ready:t,result:e,containsTags:!1}},Y=function(e,t){return r=e.representation,n=t.ready,J(r,n);var r,n},K={ready:!1,result:"",containsTags:!1},X=function(e){var t,r,n;switch(typeof e){case"string":return J(e,!0);case"object":return{ready:null===(t=e.ready)||void 0===t||t,result:null!==(r=e.result)&&void 0!==r?r:"",containsTags:null!==(n=e.containsTags)&&void 0!==n&&n};default:return K}},U=function(){function e(){this.filters=new Map}return e.prototype.register=function(e,t){this.filters.set(e,t)},e.prototype.has=function(e){return this.filters.has(e)},e.prototype.get=function(e){var t;return null!==(t=this.filters.get(e))&&void 0!==t?t:null},e.prototype.getOrDefault=function(e){var t;return null!==(t=this.get(e))&&void 0!==t?t:Y},e.prototype.unregisterFilter=function(e){this.filters.delete(e)},e.prototype.clearFilters=function(){this.filters.clear()},e.prototype.execute=function(e,t,r){var n=this.getOrDefault(e);return X(n(t,r))},e}(),W=function(){function e(e){this.storage=e}return e.prototype.set=function(e,t){this.storage.set(e,t)},e.prototype.get=function(e,t){var r;return null!==(r=this.storage.get(e))&&void 0!==r?r:t},e.prototype.has=function(e){return this.storage.has(e)},e.prototype.fold=function(e,t,r){var n=t(this.get(e,r));return this.set(e,n),n},e.prototype.post=function(e,t,r){var n=this.get(e,r);return this.set(e,t(n)),n},e.prototype.lazy=function(e,t){var r;return null!==(r=this.get(e,null))&&void 0!==r?r:this.fold(e,t,null)},e.prototype.over=function(e,t,r){var n=this.get(e,r);return this.set(e,n),t(n)},e.prototype.delete=function(e){this.storage.delete(e)},e.prototype.clear=function(){this.storage.clear()},e}(),Q=function(e){return(e+1>>>1)-1},V=function(e){return 1+(e<<1)},Z=function(e){return e+1<<1},ee=function(){function e(e){this._heap=[],this._comparator=e}return e.prototype.greater=function(e,t){return this._comparator(this._heap[e],this._heap[t])},e.prototype.swap=function(e,t){var r;r=u([this._heap[t],this._heap[e]],2),this._heap[e]=r[0],this._heap[t]=r[1]},e.prototype.siftUp=function(){for(var e=this.size()-1;e>0&&this.greater(e,Q(e));)this.swap(e,Q(e)),e=Q(e)},e.prototype.siftDown=function(){for(var e=0;V(e)<this.size()&&this.greater(V(e),e)||Z(e)<this.size()&&this.greater(Z(e),e);){var t=Z(e)<this.size()&&this.greater(Z(e),V(e))?Z(e):V(e);this.swap(e,t),e=t}},e.prototype.size=function(){return this._heap.length},e.prototype.isEmpty=function(){return 0===this.size()},e.prototype.peek=function(){return this._heap[0]},e.prototype.push=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.forEach((function(t){e._heap.push(t),e.siftUp()})),this.size()},e.prototype.pop=function(){var e=this.peek(),t=this.size()-1;return t>0&&this.swap(0,t),this._heap.pop(),this.siftDown(),e},e.prototype.generate=function(){var e;return n(this,(function(t){switch(t.label){case 0:e=this.pop(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.pop(),[3,1];case 3:return[2,null]}}))},e}(),te={priority:0,persistent:!1},re=function(e,t){return e.priority>t.priority},ne=function(){function e(){this._deferred=new Map,this._blocked=new Set}return e.prototype.register=function(e,t,r){var n,o;void 0===r&&(r=te),this._deferred.set(e,{keyword:e,procedure:t,priority:null!==(n=r.priority)&&void 0!==n?n:te.priority,persistent:null!==(o=r.persistent)&&void 0!==o?o:te.persistent})},e.prototype.registerIfNotExists=function(e,t,r){void 0===r&&(r=te),this.isRegistered(e)||this.register(e,t,r)},e.prototype.unregister=function(e){this._deferred.delete(e)},e.prototype.isRegistered=function(e){return this._deferred.has(e)},e.prototype.block=function(e){this._blocked.add(e)},e.prototype.unblock=function(e){this._blocked.delete(e)},e.prototype.isBlocked=function(e){return this._blocked.has(e)},e.prototype.clear=function(){this._deferred.clear(),this._blocked.clear()},e.prototype.executeEach=function(e){var t,r,n=new ee(re);n.push.apply(n,i(this._deferred.values()));try{for(var u=o(n.generate()),s=u.next();!s.done;s=u.next()){var a=s.value;this.isBlocked(a.keyword)||a.procedure(a,e),a.persistent||this.unregister(a.keyword)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}this._blocked.clear()},e}(),oe=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.make=function(e,t){void 0===e&&(e={}),void 0===t&&(t=new Map);var n=Object.prototype.hasOwnProperty.call(globalThis,"_closetEnvironment")?globalThis._closetEnvironment:globalThis._closetEnvironment=new Map;return new r(e,new U,new W(new Map),new ne,new ne,new W(new Map),new W(t),new W(n))},r.prototype.makeAccessor=function(t,r){var n=this,o=this.filterAccessor(t,r);return function(u){var i=o.getProcessor(u);return{execute:function(o,u){return{status:(s=i.execute(o,e.prototype.getInternals.call(n,t,r,u))).containsTags?s.ready?p.ContinueTags:p.ContainsTags:s.ready?p.Ready:p.NotReady,result:s.result};var s},getOptions:function(){return e=i.getOptions(),{separators:null!==(t=e.separators)&&void 0!==t?t:[],capture:null!==(r=e.capture)&&void 0!==r&&r};var e,t,r}}}},r.prototype.finishIteration=function(e,t){this.executeDeferred(e,t)},r.prototype.finishRun=function(e,t){this.executeAftermath(e,t),this.reset()},r}(H),ue=S.compile({text:{match:/[a-zA-Z_]+/u},numDigits:{match:/\d+(?=:|$)/u},digits:{match:/\d+/u},slash:{match:"/"},escapeseq:{match:/%\w/u},multiplierSeq:{match:/\*n\+/u},allStar:{match:/^\*$/u},numStar:{match:/\*(?=:|$)/u},star:{match:"*"},groupOpen:{match:"{"},groupAlternative:{match:","},rangeSpecifier:{match:/-/u},numGroupClose:{match:/\}(?=:|$)/u},groupClose:{match:"}"},occurSep:{match:":"}});function ie(e){return e[0]}var se,ae,ce,le,pe,fe={Lexer:ue,ParserRules:[{name:"start",symbols:["allStar"],postprocess:ie},{name:"start",symbols:["pattern"],postprocess:ie},{name:"allStar",symbols:[ue.has("allStar")?{type:"allStar"}:allStar],postprocess:function(){return function(){return!0}}},{name:"pattern",symbols:["key","num","occur"],postprocess:function(e){var t=u(e,3),r=t[0],n=t[1],o=t[2];return function(e,t,u){if(void 0===t){var i=e.match(x);if(!i)return!1;var s=i[1],a=Number(i[2]),c=Number.isNaN(a)?null:a;return r.test(s)&&n(c)&&o(u)}return r.test(e)&&n(t)&&o(u)}}},{name:"key$ebnf$1$subexpression$1",symbols:["keyComps"]},{name:"key$ebnf$1",symbols:["key$ebnf$1$subexpression$1"]},{name:"key$ebnf$1$subexpression$2",symbols:["keyComps"]},{name:"key$ebnf$1",symbols:["key$ebnf$1","key$ebnf$1$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"key",symbols:["key$ebnf$1"],postprocess:function(e){var t=u(e,1)[0];return new RegExp("^"+t.join("")+"$","u")}},{name:"keyComps",symbols:["mixedText"],postprocess:ie},{name:"keyComps",symbols:["escapeseq"],postprocess:ie},{name:"keyComps",symbols:["keyGroup"],postprocess:ie},{name:"mixedText",symbols:[ue.has("text")?{type:"text"}:text],postprocess:function(e){return u(e,1)[0].value}},{name:"mixedText",symbols:[ue.has("star")?{type:"star"}:star],postprocess:function(){return".*"}},{name:"mixedText",symbols:[ue.has("slash")?{type:"slash"}:slash],postprocess:function(){return"\\\\"}},{name:"escapeseq",symbols:[ue.has("escapeseq")?{type:"escapeseq"}:escapeseq],postprocess:function(e){return u(e,1)[0].value}},{name:"keyGroup",symbols:[ue.has("groupOpen")?{type:"groupOpen"}:groupOpen,"keyGroupInner",ue.has("groupClose")?{type:"groupClose"}:groupClose],postprocess:function(e){return u(e,2)[1].join("")}},{name:"keyGroupInner$ebnf$1",symbols:[]},{name:"keyGroupInner$ebnf$1$subexpression$1",symbols:[ue.has("groupAlternative")?{type:"groupAlternative"}:groupAlternative,"keyGroupItem"]},{name:"keyGroupInner$ebnf$1",symbols:["keyGroupInner$ebnf$1","keyGroupInner$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"keyGroupInner",symbols:["keyGroupItem","keyGroupInner$ebnf$1"],postprocess:function(e){var t=u(e,2);return i([t[0]],t[1].map((function(e){return e.value})))}},{name:"keyGroupItem$ebnf$1",symbols:[]},{name:"keyGroupItem$ebnf$1$subexpression$1",symbols:["mixedText"]},{name:"keyGroupItem$ebnf$1",symbols:["keyGroupItem$ebnf$1","keyGroupItem$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"keyGroupItem",symbols:["keyGroupItem$ebnf$1"],postprocess:function(e){return u(e,1)[0].join("")}},{name:"num$ebnf$1$subexpression$1",symbols:["numPredicate"]},{name:"num$ebnf$1",symbols:["num$ebnf$1$subexpression$1"],postprocess:ie},{name:"num$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"num",symbols:["num$ebnf$1"],postprocess:function(e){var t=u(e,1)[0];return t?t[0]:function(e){return null===e}}},{name:"numPredicate",symbols:["numDigits"],postprocess:ie},{name:"numPredicate",symbols:["numStar"],postprocess:ie},{name:"numPredicate",symbols:["numGroup"],postprocess:ie},{name:"numDigits",symbols:[ue.has("numDigits")?{type:"numDigits"}:numDigits],postprocess:function(e){var t=u(e,1)[0];return function(e){return e===Number(t.value)}}},{name:"numStar",symbols:[ue.has("numStar")?{type:"numStar"}:numStar],postprocess:function(){return function(e){return!0}}},{name:"numGroup",symbols:[ue.has("groupOpen")?{type:"groupOpen"}:groupOpen,"numGroupInner",ue.has("numGroupClose")?{type:"numGroupClose"}:numGroupClose],postprocess:function(e){var t=u(e,2)[1];return function(e){return t.reduce((function(t,r){return t||r(e)}),!1)}}},{name:"numGroupInner$ebnf$1",symbols:[]},{name:"numGroupInner$ebnf$1$subexpression$1",symbols:[ue.has("groupAlternative")?{type:"groupAlternative"}:groupAlternative,"numGroupItem"]},{name:"numGroupInner$ebnf$1",symbols:["numGroupInner$ebnf$1","numGroupInner$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"numGroupInner",symbols:["numGroupItem","numGroupInner$ebnf$1"],postprocess:function(e){var t=u(e,2);return i([t[0]],t[1].map((function(e){return u(e,2)[1]})))}},{name:"numGroupItem$ebnf$1$subexpression$1",symbols:["numGroupPredicate"]},{name:"numGroupItem$ebnf$1",symbols:["numGroupItem$ebnf$1$subexpression$1"],postprocess:ie},{name:"numGroupItem$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"numGroupItem",symbols:["numGroupItem$ebnf$1"],postprocess:function(e){var t=u(e,1)[0];return t?t[0]:function(e){return null===e}}},{name:"numGroupPredicate",symbols:["digits"],postprocess:ie},{name:"numGroupPredicate",symbols:["range"],postprocess:ie},{name:"numGroupPredicate",symbols:["multiple"],postprocess:ie},{name:"digits",symbols:[ue.has("digits")?{type:"digits"}:digits],postprocess:function(e){var t=u(e,1)[0];return function(e){return e===Number(t.value)}}},{name:"range",symbols:["bounded"],postprocess:ie},{name:"range",symbols:["leftBounded"],postprocess:ie},{name:"range",symbols:["rightBounded"],postprocess:ie},{name:"bounded",symbols:[ue.has("digits")?{type:"digits"}:digits,ue.has("rangeSpecifier")?{type:"rangeSpecifier"}:rangeSpecifier,ue.has("digits")?{type:"digits"}:digits],postprocess:function(e){var t=u(e,3),r=t[0],n=t[2];return function(e){return"number"==typeof e&&Number(r.value)<=e&&e<=Number(n.value)}}},{name:"leftBounded",symbols:[ue.has("digits")?{type:"digits"}:digits,ue.has("rangeSpecifier")?{type:"rangeSpecifier"}:rangeSpecifier],postprocess:function(e){var t=u(e,1)[0];return function(e){return"number"==typeof e&&Number(t.value)<=e}}},{name:"rightBounded",symbols:[ue.has("rangeSpecifier")?{type:"rangeSpecifier"}:rangeSpecifier,ue.has("digits")?{type:"digits"}:digits],postprocess:function(e){var t=u(e,2)[1];return function(e){return"number"==typeof e&&e<=Number(t.value)}}},{name:"multiple",symbols:[ue.has("digits")?{type:"digits"}:digits,ue.has("multiplierSeq")?{type:"multiplierSeq"}:multiplierSeq,ue.has("digits")?{type:"digits"}:digits],postprocess:function(e){var t=u(e,3),r=t[0],n=t[2];return function(e){return(e-n)%r==0}}},{name:"occur$ebnf$1$subexpression$1",symbols:[ue.has("occurSep")?{type:"occurSep"}:occurSep,"occurPredicate"]},{name:"occur$ebnf$1",symbols:["occur$ebnf$1$subexpression$1"],postprocess:ie},{name:"occur$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"occur",symbols:["occur$ebnf$1"],postprocess:function(e){var t=u(e,1)[0];return t?function(e){return null===e||t[1](e)}:function(){return!0}}},{name:"occurPredicate",symbols:["numDigits"],postprocess:ie},{name:"occurPredicate",symbols:["numStar"],postprocess:ie},{name:"occurPredicate",symbols:["occurGroup"],postprocess:ie},{name:"occurGroup",symbols:[ue.has("groupOpen")?{type:"groupOpen"}:groupOpen,"occurGroupInner",ue.has("groupClose")?{type:"groupClose"}:groupClose],postprocess:function(e){var t=u(e,2)[1];return function(e){return t.reduce((function(t,r){return r||t(e)}),!1)}}},{name:"occurGroupInner$ebnf$1",symbols:[]},{name:"occurGroupInner$ebnf$1$subexpression$1",symbols:[ue.has("groupAlternative")?{type:"groupAlternative"}:groupAlternative,"numGroupPredicate"]},{name:"occurGroupInner$ebnf$1",symbols:["occurGroupInner$ebnf$1","occurGroupInner$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"occurGroupInner",symbols:["numGroupPredicate","occurGroupInner$ebnf$1"],postprocess:function(e){var t=u(e,2);return i([t[0]],t[1].map((function(e){return u(e,2)[1]})))}}],ParserStart:"start"},he=b.Grammar.fromCompiled(fe),de=function(){function e(e){this.predicate=function(e){var t=new b.Parser(he);try{var r=t.feed(e).results;return r.length>1&&console.log("Tag selector is ambiguous: ",e,r),r[0]}catch(e){return console.log("Tag selector failed to parse: ",e),function(){return!1}}}(e)}return e.make=function(t){return new e(t)},e.prototype.check=function(e,t,r){return void 0===r&&(r=null),this.predicate(e,t,r)},e.prototype.checkFullKey=function(e,t){return void 0===t&&(t=null),this.predicate(e,void 0,t)},e.prototype.checkTagIdentifier=function(e){var t=e.match(x);if(!t)return!1;var r=t[1],n=t[2].length>0?Number(t[2]):null,o=t[3]?Number(t[3]):null;return this.predicate(r,n,o)},e}(),me=function(e){return e},ve=function(e,t){return t},ye="A-Za-z\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B4\\u08B6-\\u08BD\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C60\\u0C61\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D5F-\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16F1-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1C80-\\u1C88\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FD5\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC",ge="0-9\\xB2\\xB3\\xB9\\xBC-\\xBE\\u0660-\\u0669\\u06F0-\\u06F9\\u07C0-\\u07C9\\u0966-\\u096F\\u09E6-\\u09EF\\u09F4-\\u09F9\\u0A66-\\u0A6F\\u0AE6-\\u0AEF\\u0B66-\\u0B6F\\u0B72-\\u0B77\\u0BE6-\\u0BF2\\u0C66-\\u0C6F\\u0C78-\\u0C7E\\u0CE6-\\u0CEF\\u0D58-\\u0D5E\\u0D66-\\u0D78\\u0DE6-\\u0DEF\\u0E50-\\u0E59\\u0ED0-\\u0ED9\\u0F20-\\u0F33\\u1040-\\u1049\\u1090-\\u1099\\u1369-\\u137C\\u16EE-\\u16F0\\u17E0-\\u17E9\\u17F0-\\u17F9\\u1810-\\u1819\\u1946-\\u194F\\u19D0-\\u19DA\\u1A80-\\u1A89\\u1A90-\\u1A99\\u1B50-\\u1B59\\u1BB0-\\u1BB9\\u1C40-\\u1C49\\u1C50-\\u1C59\\u2070\\u2074-\\u2079\\u2080-\\u2089\\u2150-\\u2182\\u2185-\\u2189\\u2460-\\u249B\\u24EA-\\u24FF\\u2776-\\u2793\\u2CFD\\u3007\\u3021-\\u3029\\u3038-\\u303A\\u3192-\\u3195\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\uA620-\\uA629\\uA6E6-\\uA6EF\\uA830-\\uA835\\uA8D0-\\uA8D9\\uA900-\\uA909\\uA9D0-\\uA9D9\\uA9F0-\\uA9F9\\uAA50-\\uAA59\\uABF0-\\uABF9\\uFF10-\\uFF19",be=new RegExp("["+ye+"]","gu"),xe=new RegExp("["+ge+"]","gu"),Ae=new RegExp("["+ye+ge+"]","gu"),we=function(e,t){var r,n,u,i,s=[];try{for(var a=o(t),c=a.next();!c.done;c=a.next()){var l=e[d=c.value];l&&s.push(l)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}if(t.length<e.length){var p=Array.from(new Array(e.length-t.length),(function(e,r){return r+t.length}));try{for(var f=o(p),h=f.next();!h.done;h=f.next()){var d=h.value;s.push(e[d])}}catch(e){u={error:e}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(u)throw u.error}}}return s},Ee=function(){function e(e,t,r){this.separator=e,this.mapper=t,this.processor=r}return e.make=function(t){var r=void 0===t?{}:t,n=r.separator,o=void 0===n?", ":n,u=r.mapper,i=void 0===u?me:u,s=r.processor;return new e(o,i,void 0===s?me:s)},e.prototype.toStylizer=function(t){var r=void 0===t?{}:t,n=r.separator,o=void 0===n?this.separator:n,u=r.mapper,i=void 0===u?this.mapper:u,s=r.processor;return new e(o,i,void 0===s?this.processor:s)},e.prototype.stylize=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return this.processor(e.flatMap((function(e,n,o){return t.mapper.apply(t,i([e,n],r.map((function(e){return e[n]})),[o]))})).join(this.separator))},e.prototype.stylizeFull=function(e,t,r){var n=this;return void 0===t&&(t=[]),void 0===r&&(r=[]),this.processor.apply(this,i([e.flatMap((function(e,r,o){return n.mapper.apply(n,i([e,r],t.map((function(e){return e[r]})),[o]))})).join(this.separator)],r))},e}(),Fe=function(e){return function(t,r){return function(n,o){var i=u(e(n,o),2),s=i[0],a=i[1];return o.cache.over("sequences",(function(e){e.includes(a)||e.push(a)}),[]),function(e,t,r,n){return function(o,u){var i=e+":apply",s=e+":length",a=t+":waitingSet",c=t+":shuffle";if(u.cache.get(i,!1)){if(u.cache.get(a,new Set).size>0)return;for(var l=[],p=u.cache.get(c,[]),f=u.cache.get(s,0),h=0;h<f;h++){var d=p.shift();d&&l.push(d)}return l}if(u.ready){var m=n(o,u);if(0===m.length)return m;u.cache.fold(c,(function(e){return e.concat(m)}),[]),u.cache.set(s,m.length),u.deferred.registerIfNotExists(i,(function(){u.cache.set(i,!0),u.cache.over(a,(function(t){return t.delete(e)}),new Set)}),{priority:65}),u.deferred.registerIfNotExists(c,(function(){u.cache.over(a,(function(e){return e.size>0}),new Set)||u.cache.fold(c,(function(e){var t=u.memory.fold(c,(function(e){return r(e,u.cache.get(c,[]).length)}),[]);return we(e,t)}),[])}))}else u.cache.over(a,(function(t){return t.add(e)}),new Set)}}(s,a,r,t)(n,o)}}},ke=Fe((function(e,t){var r=e.fullKey,n=e.fullOccur;return[r+":"+n,r+":"+n]})),Se=Fe((function(e,t){var r=e.fullKey;return[r+":"+e.fullOccur,r]})),Ce=function(e,t){if(e.length>=t)return e;var r=function(e){for(var t=e.slice(0),r=e.length;0!==r;){var n=Math.floor(Math.random()*r),o=t[r-=1];t[r]=t[n],t[n]=o}return t}(Array.from(new Array(t-e.length),(function(t,r){return r+e.length})));return i(e,r)},Be={shuffle:function(e){var t=void 0===e?{}:e,r=t.tagname,n=void 0===r?"mix":r,o=t.stylizer,u=void 0===o?Ee.make():o,i=t.sortInStrategy,s=void 0===i?Ce:i;return function(e){e.register(n,(function(e,t){var r=(e.num?Se:ke)((function(e){var t=e.values;return null!=t?t:[]}),s)(e,t);if(r)return u.stylize(r)}),{separators:["||"]})}}},De={priority:35,persistent:!0},Ne={order:function(e){var t=void 0===e?{}:e,r=t.tagname,n=void 0===r?"ord":r,i=t.separator,s=void 0===i?",":i,a=t.cmdSeparator,c=void 0===a?"::":a,l=t.sortInStrategy,p=void 0===l?Ce:l;return function(e){e.register(n,(function(e,t){var r,n,i=t.deferred,s=t.cache,a=t.memory,c=new Set(s.get("sequences",[])),l=function(t,r){var n=r.map(de.make),l=e.key+":"+e.fullOccur+":ord:"+t;i.register(l,(function(){var e,t,r=Array.from(c).filter((function(e){return!!n.some((function(t){return t.checkTagIdentifier(e)}))&&(c.delete(e),!0)})),f=r.map((function(e){return e+":shuffle"})),h=function(e,t){var r=f[e],n=t+":waitingSet";if(i.block(r),0!==s.get(n,new Set).size)return"continue";var o=f.reduce((function(e,t){var r=a.get(t,[]);return e.length<r.length?r:e}),[]),u=s.get(r,[]),c=p(s.get(l,o),u.length);s.fold(r,(function(e){return we(e,c)}),[]),s.set(l,c),a.set(r,c)};try{for(var d=(e=void 0,o(r.entries())),m=d.next();!m.done;m=d.next()){var v=u(m.value,2);h(v[0],v[1])}}catch(t){e={error:t}}finally{try{m&&!m.done&&(t=d.return)&&t.call(d)}finally{if(e)throw e.error}}0===c.size&&i.unregister(l)}),De)};try{for(var f=o(e.values.entries()),h=f.next();!h.done;h=f.next()){var d=u(h.value,2);l(d[0],d[1])}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}return{ready:!0}}),{separators:[c,s]})}}},$e=function(e,t,r,o){var u,i,s;return void 0===r&&(r=[]),void 0===o&&(o=function(){return!1}),n(this,(function(n){switch(n.label){case 0:u=[],i=0,n.label=1;case 1:return!o(r)&&i<1e3?(s=e(),r.includes(s)||u.includes(s)?[3,3]:(t&&u.push(s),[4,s])):[3,4];case 2:n.sent(),n.label=3;case 3:return i++,[3,1];case 4:return[2,u]}}))},Ie=function(e,t){return function(){return e+Math.floor(Math.random()*(t-e))}},Oe=function(e,t,r){return function(n){var o=void 0===n?{}:n,i=o.tagname,s=void 0===i?"gen":i,a=o.uniqueConstraintId,c=void 0===a?"uniq":a,l=o.separator,p=void 0===l?{sep:","}:l;return function(n){var o="gen:"+c;n.register(s,(function(n,i){var a=n.values,c=n.fullOccur,l=n.num,p=i.memory,f=u(1===a.length?[1,Number(a[0]),r]:a.map(Number),3),h=f[0],d=void 0===h?1:h,m=f[1],v=void 0===m?100:m,y=f[2],g=void 0===y?r:y,b=Number.isInteger(l)?o+":"+l:o,x="gen:"+s+":"+c;return{ready:!0,result:p.lazy(x,(function(){var r=$e(e(d,v),!0,Number.isInteger(l)?p.get(b,[]):[]).next();return r.done?"":t(r.value,g)}))}}),{separators:[p]})}}},Te={generateInteger:Oe(Ie,(function(e,t){return String(e*t)}),1),generateReal:Oe((function(e,t){return function(){return e+Math.random()*(t-e)}}),(function(e,t){return e.toFixed(t)}),2)},je={stylize:function(e){var t=void 0===e?{}:e,r=t.tagname,n=void 0===r?"s":r,o=t.stylizer,u=void 0===o?Ee.make():o,i=t.separator,s=void 0===i?"::":i;return function(e){e.register(n,(function(e){return u.stylize(e.values)}),{separators:[s]})}},process:function(e){var t=void 0===e?{}:e,r=t.tagname,n=void 0===r?"s":r,o=t.processor,u=void 0===o?me:o;return function(e){e.register(n,(function(e){return u(e.values)}),{separators:[]})}}},_e={sep:";"},Pe={sep:"=",trim:!0,max:2},Me=function(){function e(e){this.defaultValue=e,this.selectors=[]}return e.prototype.set=function(e,t){this.selectors.unshift([de.make(e),t])},e.prototype.get=function(e,t,r){var n=this.selectors.find((function(n){return u(n,1)[0].check(e,t,r)}));return n?n[1]:this.defaultValue},e}(),Le=function(e){return function(t,r,n){return function(o,u){var s=u.cache;return o.values.forEach((function(o){s.over(t,n.apply(void 0,i(o)),new e(r))})),{ready:!0}}}},ze=Le(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype.setNumber=function(e,t){this.set(e,Number.isNaN(t)?0:t)},r}(Me)),Ge=Le(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype.on=function(e){this.set(e,!0)},r.prototype.off=function(e){this.set(e,!1)},r}(Me)),Re=function(e){return{get:function(){return e}}},qe={setNumber:function(e){var t=void 0===e?{}:e,r=t.tagname,n=void 0===r?"set":r,o=t.storeId,u=void 0===o?"numerical":o,i=t.separator,s=void 0===i?_e:i,a=t.assignmentSeparator,c=void 0===a?Pe:a;return function(e){return e.register(n,ze(u,0,(function(e,t){return function(r){return r.setNumber(e,Number(t))}})),{separators:[s,c]})}},activate:function(e){var t=void 0===e?{}:e,r=t.tagname,n=void 0===r?"on":r,o=t.storeId,u=void 0===o?"active":o,i=t.separator,s=void 0===i?_e:i;return function(e){return e.register(n,Ge(u,!1,(function(e){return function(t){t.on(e)}})),{separators:[s,Pe]})}},deactivate:function(e){var t=void 0===e?{}:e,r=t.tagname,n=void 0===r?"off":r,o=t.storeId,u=void 0===o?"active":o,i=t.separator,s=void 0===i?_e:i;return function(e){return e.register(n,Ge(u,!1,(function(e){return function(t){return t.off(e)}})),{separators:[s,Pe]})}}},He=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.prototype.setList=function(e,t){this.set(e,t)},r.prototype.overwriteList=function(e,t,r){void 0===r&&(r=0);for(var n=this.getList(e),o=0;o<t.length;o++)n[r+o]=t[o];this.setList(e,n)},r.prototype.getList=function(e){return this.get(e,[])},r}(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r}(W)),Je=(se=He,function(e,t){return function(r,n){var o;return{ready:!0,result:null!==(o=n.cache.over(e,t(r,n),new se(new Map)))&&void 0!==o?o:""}}}),Ye=function(e,t){return function(e,t){return""}},Ke=(ae=function(e,t,r){return function(n,o){return null===n.num?e.setList(t,r):e.overwriteList(t,r,n.num),""}},function(e){var t=void 0===e?{}:e,r=t.tagname,n=void 0===r?"setl":r,o=t.storeId,i=void 0===o?"lists":o,s=t.postprocess,a=void 0===s?Ye:s,c=t.separator,l=void 0===c?{sep:"::"}:c,p=t.innerSeparator,f=void 0===p?{sep:"||"}:p;return function(e){return e.register(n,Je(i,function(e,t){return function(r,n){return function(o){var i=u(2===r.values.length?r.values:[["default"],r.values[0]],2),s=i[0],a=i[1],c=s[0],l=o.getList(c),p=e(o,c,a)(r,n);return t(p,l)(r,n)}}}(ae,a)),{separators:[l,f]})}}),Xe=function(e,t){return function(t,r){return e}},Ue=function(e){return function(t){var r=void 0===t?{}:t,n=r.tagname,o=void 0===n?"pick":n,u=r.storeId,i=void 0===u?"lists":u,s=r.postprocess,a=void 0===s?Xe:s;return function(t){return t.register(o,Je(i,function(e,t){return function(r,n){return function(o){var u=r.values||"default",i=o.getList(u),s=e(i,u)(r,n);return t(s,i)(r,n)}}}(e,a)))}}},We={setList:Ke,pick:Ue((function(e,t){return function(r,n){var o=n.memory,u="pick:picked:"+r.fullKey+":"+r.occur,i=o.lazy(u,(function(){var n,u,i=Ie(0,e.length),s=(n=0,u=e.length,function(e){return e.length>=u-n}),a=Boolean(r.num),c="pick:uniqList:"+r.fullKey,l=a?o.over(c,(function(e){return Object.prototype.hasOwnProperty.call(e,t)||(e[t]=[]),e}),{})[t]:[],p=Array.from(e).reduce((function(e,t,r){return void 0===t&&e.push(r),e}),[]),f=l.concat(p),h=$e(i,a,f,s).next();if(!h.done)return l.push(h.value),h.value}));return Number.isInteger(i)?e[i]:""}})),pickIndex:Ue((function(e,t){return function(t,r){return e[Number(t.num)||0]}})),pickCardNumber:Ue((function(e,t){return function(t,r){var n,o=e[r.preset.cardNumber];return null!==(n=null!=o?o:e[0])&&void 0!==n?n:""}}))},Qe=function(e){return Object.prototype.hasOwnProperty.call(e,"tagname")?[e.tagname]:[]},Ve=function(e,t){return r(r({},e),{tagname:t[0]})},Ze=function(e){return function(t,r){var n=void 0===r?{wrapId:"wrapped",getTagnames:Qe,setTagnames:Ve}:r,u=n.wrapId,i=n.getTagnames,s=n.setTagnames;return function(r){return void 0===r&&(r={}),function(n){var a,c,l=i(r),p=function(e){return e+":"+u+":internal"},f=new Map,h=l.map((function(e){var t=p(e);return f.set(e,t),t}));t(s(r,h))(n);var d=function(t,r){var n=f.get(t.key);return e(Object.assign({},t,{keyInternal:n}),r),r.filters.getOrDefault(n)(t,r)};try{for(var m=o(l),v=m.next();!v.done;v=m.next()){var y=v.value;n.register(y,d,n.getOptions(p(y)))}}catch(e){a={error:e}}finally{try{v&&!v.done&&(c=m.return)&&c.call(m)}finally{if(a)throw a.error}}}}}},et=function(e){return function(t,r,n){return void 0===n&&(n={wrapId:"wrapped",getTagnames:Qe,setTagnames:Ve}),Ze((function(t,n){e(n).registerIfNotExists(t.keyInternal,r)}))(t,n)}},tt=et((function(e){return e.deferred})),rt=et((function(e){return e.aftermath})),nt=function(e,t,r,n){var o=void 0===n?{wrapId:"sum",getTagnames:Qe,setTagnames:Ve}:n,u=o.wrapId,i=o.setTagnames;return function(n){var o=void 0===n?{}:n,s=o.tagname,a=void 0===s?"sum":s,c=o.optionsFalse,l=void 0===c?{}:c,p=o.optionsTrue,f=void 0===p?{}:p;return function(n){var o=a+":"+u+":false",s=a+":"+u+":true";e(i(l,[o]))(n),t(i(f,[s]))(n);n.register(a,(function(e,t){return r(e,t)?t.filters.getOrDefault(s)(e,t):t.filters.getOrDefault(o)(e,t)}),n.getOptions(s))}}},ot=function(e,t,r,n,o,u,i){var s=void 0===i?{wrapId:"sumFour",getTagnames:Qe,setTagnames:Ve}:i,a=s.wrapId,c=s.setTagnames;return function(i){var s=void 0===i?{}:i,l=s.tagname,p=void 0===l?"sum":l,f=s.optionsZero,h=void 0===f?{}:f,d=s.optionsOne,m=void 0===d?{}:d,v=s.optionsTwo,y=void 0===v?{}:v,g=s.optionsThree,b=void 0===g?{}:g;return function(i){var s=p+":"+a+":zero",l=p+":"+a+":two";nt(e,t,o)({tagname:s,optionsFalse:c(h,[s]),optionsTrue:c(m,[s])})(i),nt(r,n,o)({tagname:l,optionsFalse:c(y,[l]),optionsTrue:c(b,[l])})(i);i.register(p,(function(e,t){return u(e,t)?t.filters.getOrDefault(l)(e,t):t.filters.getOrDefault(s)(e,t)}))}}},ut=function(e){return function(t){var r=(void 0===t?{}:t).tagname,n=void 0===r?"s":r;return function(t){t.register(n,e)}}},it=function(e,t,r,n){return e-r<=t&&t<=e+n},st=function(e,t){var r=e.key,n=e.num,o=e.fullOccur,u=t.preset,i=t.cache,s=Re(0),a=null,c=null;switch(n){case null:return!1;case 0:return!0;default:return"number"==typeof u.cardNumber&&(a=i.get("flashcardActiveBottom",s).get(r,u.cardNumber,o),c=i.get("flashcardActiveTop",s).get(r,u.cardNumber,o),it(u.cardNumber,n,a,c))}},at=function(e,t){return t.cache.get("flashcardActive",Re(!1)).get(e.key,e.num,e.fullOccur)},ct=function(e,t){return at(e,t)||st(e,t)},lt=function(e,t){return"back"===t.preset.side},pt=lt,ft=Object.freeze({__proto__:null,isActiveWithinRange:it,isActive:function(e,t){var r=e.num,n=t.preset;switch(r){case null:return!1;case 0:return!0;default:return!!Object.prototype.hasOwnProperty.call(n,"cardNumber")&&r===n.cardNumber}},isActiveGetRange:st,isActiveOverwritten:at,isActiveAll:ct,isBack:lt,isBackAll:pt}),ht=Re(!1),dt=Re(0),mt=function(e,t){var r=t.cache,n=t.preset;if(!n.cardNumber)return[0,0,0,0];return[r.get("flashcardShowBottom",dt).get(e.key,n.cardNumber,e.fullOccur),r.get("flashcardShowTop",dt).get(e.key,n.cardNumber,e.fullOccur),r.get("flashcardHideBottom",dt).get(e.key,n.cardNumber,e.fullOccur),r.get("flashcardHideTop",dt).get(e.key,n.cardNumber,e.fullOccur)]},vt=function(e){return function(t){return function(r,n){return function(o,u){return u.cache.get("flashcardShow",ht).get(o.key,o.num,o.fullOccur)?r(o,u):u.cache.get("flashcardHide",ht).get(o.key,o.num,o.fullOccur)?n(o,u):e(t)(r,n)(o,u)}}}}((ce=function(e){return function(t,r){return function(n,o){return e(t,r)(n,o)}}},function(e){return function(t,r){return function(n,o){if(!Object.prototype.hasOwnProperty.call(o.preset,"cardNumber"))return ce(e)(t,r)(n,o);var i=u(mt(n,o),4),s=i[0],a=i[1],c=i[2],l=i[3],p=o.preset.cardNumber;return p&&n.num?p-s<=n.num&&n.num<=p+a?t(n,o):p-c<=n.num&&n.num<=p+l?r(n,o):ce(e)(t,r)(n,o):e(t,r)(n,o)}}})),yt=function(e,t,r){return void 0===e&&(e=ct),void 0===t&&(t=pt),void 0===r&&(r=vt),function(n,o){return function(u,i,s,a,c,l){return void 0===l&&(l={}),function(p){var f=u+":internal";ot(ut(r(n)(a,c)),ut(i),ut(r(o)(a,c)),ut(s),e,t)({tagname:f})(p);p.register(u,(function(e,t){return t.filters.getOrDefault(f)(e,t)}),l)}}}},gt=(le="[...]",function(e){return le}),bt=function(e){var t,r=e(ve,ve),n=e(me,me),i=e(ve,me),s=(t=[[r,{getTagnames:function(e){var t;return[null!==(t=e.tagnameHide)&&void 0!==t?t:e.tagname]}}],[n,{getTagnames:function(e){var t;return[null!==(t=e.tagnameShow)&&void 0!==t?t:e.tagname+"s"]}}],[i,{getTagnames:function(e){var t;return[null!==(t=e.tagnameReveal)&&void 0!==t?t:e.tagname+"r"]}}]],function(e){return function(r){var n,i,s=null!=e?e:{};try{for(var a=o(t),c=a.next();!c.done;c=a.next()){var l=u(c.value,2),p=l[0],f=l[1],h=void 0===f?{}:f,d=h.setTagnames,m=void 0===d?Ve:d,v=h.getTagnames;p(m(s,(void 0===v?Qe:v)(s)))(r)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}});return s.hide=r,s.show=n,s.reveal=i,s},xt=function(e){return Array.isArray(e[0])?e[0].map((function(t,r){return e.map((function(e){return e[r]}))})):[e]},At=function(e,t){return function(r,n){return n.ready?e.stylize.apply(e,i(xt(t(r,n)))):{ready:!1}}},wt=function(e,t){return function(r,n){if(!n.ready)return{ready:!1};var o=t(r,n);return o?e.stylize.apply(e,i(xt(o))):{ready:!1}}},Et=Ee.make({processor:function(e){return'<span style="color: cornflowerblue;">'+e+"</span>"}}),Ft=Et.toStylizer({mapper:function(e){return"["+e+"]"}}),kt=function(e,t){var r;return[null!==(r=e.values[1])&&void 0!==r?r:"..."]},St=function(e,t){return{ready:t.ready,result:e.values[0]}},Ct=function(e,t){return[e.values[0]]},Bt=bt((function(e,t){return function(r){void 0===r&&(r={});var n=r.tagname,o=void 0===n?"c":n,u=r.inactiveEllipser,i=void 0===u?gt:u,s=r.frontStylizer,a=void 0===s?Ft:s,c=r.frontEllipser,l=void 0===c?kt:c,p=r.backStylizer,f=void 0===p?Et:p,h=r.backEllipser,d=void 0===h?Ct:h,m=r.separator,v=void 0===m?{sep:"::",max:2}:m,y=r.flashcardTemplate,g=void 0===y?yt():y,b=At(a,l),x=At(f,d),A={separators:[v]};return g(e,t)(o,b,x,St,i,A)}})),Dt=function(e,t){return e.values?e.values.flatMap((function(e,t){return e.map((function(e){return[e,t]}))})):[]},Nt=function(e,t){return e.values[0]},$t=Ee.make(),It=$t.toStylizer({processor:function(e){return"( "+e+" )"},mapper:function(e){return'<span style="color: orange;">'+e+"</span>"}}),Ot=It.toStylizer({mapper:function(e,t,r){return'<span style="color: '+(0===r?"lime":"red")+';">'+e+"</span>"}}),Tt=bt((function(e,t){return function(r){void 0===r&&(r={});var n=r.tagname,o=void 0===n?"mc":n,u=r.frontStylizer,i=void 0===u?It:u,s=r.backStylizer,a=void 0===s?Ot:s,c=r.inactiveStylizer,l=void 0===c?$t:c,p=r.contexter,f=void 0===p?Nt:p,h=r.ellipser,d=void 0===h?gt:h,m=r.getValues,v=void 0===m?Dt:m,y=r.sequence,g=void 0===y?Se:y,b=r.sortInStrategy,x=void 0===b?Ce:b,A=r.categorySeparator,w=void 0===A?"::":A,E=r.valueSeparator,F=void 0===E?"||":E,k=r.flashcardTemplate,S=void 0===k?yt():k,C=g(v,x),B=wt(i,C),D=wt(a,C),N={separators:[{sep:w},{sep:F,keepEmpty:!1}]};return S(e,t)(o,B,D,At(l,f),d,N)}})),jt=function(e){return{result:e.values,containsTags:!0}},_t=function(){return""},Pt=bt((function(e,t){return function(r){void 0===r&&(r={});var n=r.tagname,o=void 0===n?"spec":n,u=r.flashcardTemplate;return(void 0===u?yt():u)(e,t)(o,jt,jt,jt,_t,{capture:!0})}})),Mt=function(e,t){return e.values},Lt=Ee.make({separator:", "}),zt=Ee.make({processor:function(e){return'<span style="color: cornflowerblue;">'+e+"</span>"}}),Gt=function(e,t){return e.values?e.values:[]},Rt=function(e,t){return At(e,Mt)},qt=function(e,t){return function(r,n){return function(o){void 0===o&&(o={});var u=o.tagname,i=void 0===u?"shuf":u,s=o.activeStylizer,a=void 0===s?zt:s,c=o.inactiveStylizer,l=void 0===c?Lt:c,p=o.contexter,f=void 0===p?Gt:p,h=o.ellipser,d=void 0===h?gt:h,m=o.sequence,v=void 0===m?Se:m,y=o.sortInStrategy,g=void 0===y?Ce:y,b=o.separator,x=void 0===b?{sep:"::"}:b,A=o.flashcardTemplate,w=void 0===A?yt():A,E={separators:[x]},F=v(f,g),k=e(a,F),S=t(a,F),C=At(l,f);return w(r,n)(i,k,S,C,d,E)}}},Ht={cloze:Bt,multipleChoice:Tt,specification:Pt,mingle:bt(qt(wt,wt)),sort:bt(qt(wt,Rt)),jumble:bt(qt(Rt,wt))},Jt=/%(.)/gu,Yt={separators:[{sep:"::",max:2}],capture:!0},Kt=r(r(r(r(r(r(r(r({},Be),Ne),Te),je),qe),We),Ht),{debug:function(){return function(e){e.register("tagpath",(function(e,t){return t.path.join(":")})),e.register("never",(function(){})),e.register("empty",(function(){return""})),e.register("key",(function(e){return e.key})),e.register("stopIteration",(function(e,t){var r=e.values,n=t.filters,o=Number(r),u=n.getOrDefault("base");return n.register("base",(function(e,t){var r;return t.iteration>=o?null!==(r=e.valuesText)&&void 0!==r?r:"":u(e,t)})),{ready:!0}})),e.register("memorytest",(function(e,t){var r=t.memory;return String(r.fold("base:memorytest",(function(e){return++e}),0))}))}},define:function(e){return void 0===e&&(e={}),function(t){var r=e.tagname,n=void 0===r?"def":r,o={separators:[{sep:"::"}]};t.register(n,(function(e){var r=u(e.values,2),n=r[0],i=r[1];return t.register(n,(function(e){return{result:i.replace(Jt,function(e){return function(t,r){var n,o=null;switch(r){case"%":return r;case"n":return"number"==typeof e.num?String(e.num):"";case"k":return e.key;case"f":return e.fullKey;default:return o=Number(r),Number.isNaN(o)?t:null!==(n=e.values[o])&&void 0!==n?n:""}}}(e)),containsTags:!0}}),o),{ready:!0}}),Yt)}}}),Xt={wrap:Ze,deferred:tt,aftermath:rt,sum:nt,sumFour:ot,product:function(e,t,r,n){void 0===r&&(r=function(){return function(){return{ready:!0}}});var o=void 0===n?{wrapId:"product",getTagnames:Qe,setTagnames:Ve}:n,u=o.wrapId,i=o.setTagnames;return function(n){var o=void 0===n?{}:n,s=o.tagname,a=void 0===s?"prod":s,c=o.optionsFirst,l=void 0===c?{}:c,p=o.optionsSecond,f=void 0===p?{}:p;return function(n){var o=a+":"+u+":fst",s=a+":"+u+":snd";e(i(l,[o]))(n),t(i(f,[s]))(n);n.register(a,(function(e,t){return r(t.filters.getOrDefault(o)(e,t),t.filters.getOrDefault(s)(e,t))(e,t)}),n.getOptions(o))}}}},Ut={withinTag:ke,acrossTag:Se},Wt=function(e){var t=document.createElement("style");t.type="text/css",t.innerHTML=e,globalThis.document.head.appendChild(t)},Qt=/<img[^>]*?src="(.+?)"[^>]*>/g,Vt=function(e){var t,r=[];do{(t=Qt.exec(e))&&r.push(t[1])}while(t);return r},Zt=function(e){if(navigator.userAgent.search("Chrome")>=0)return[e.offsetX,e.offsetY];var t=e.currentTarget,r=t.getBoundingClientRect(),n=t.parentElement.getBoundingClientRect();return[e.layerX-(n.left-r.left),e.layerY-(n.top-r.top)]},er=function(e,t){var r=document.querySelector(e);r&&(r.complete?t({target:r}):r.addEventListener("load",t))},tr="\nimg {\n  max-width: 100% !important;\n}\n\n.closet-occlusion-container {\n  display: inline-block;\n  position: relative;\n}\n\n.closet-occlusion-container > * {\n  display: block;\n\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.closet-occlusion-container > svg {\n  position: absolute;\n  top: 0;\n}\n\n.closet-occlusion-container__shape > text {\n  text-anchor: middle;\n  dominant-baseline: central;\n  pointer-events: none;\n}",rr="http://www.w3.org/2000/svg",nr=function(){function e(e,t,r){var n=this;this.scaleFactorX=1,this.scaleFactorY=1,this.maxOcclusions=500,this.elements=[],this.container=e,this.image=t,this.svg=r,this.resizer=new globalThis.ResizeObserver((function(){return n.resize()})),this.resizer.observe(t),this.setScaleFactors()}return e.prototype.setScaleFactors=function(){this.scaleFactorX=this.image.width/this.image.naturalWidth,this.scaleFactorY=this.image.height/this.image.naturalHeight},e.wrapImage=function(t){var r=document.createElement("div");t.parentNode&&t.parentNode.replaceChild(r,t),r.appendChild(t);var n=document.createElementNS(rr,"svg");n.setAttributeNS(null,"width","100%"),n.setAttributeNS(null,"height","100%");var o=window.getComputedStyle(t);return n.style.zoom=o.getPropertyValue("zoom"),n.style.transform=o.getPropertyValue("transform"),r.appendChild(n),r.classList.add("closet-occlusion-container"),new e(r,t,n)},Object.defineProperty(e.prototype,"scaleFactors",{get:function(){return[this.scaleFactorX,this.scaleFactorY]},enumerable:!1,configurable:!0}),e.prototype.resize=function(){var e,t;if(this.setScaleFactors(),this.scaleFactors.includes(0))this.resizer.disconnect();else try{for(var r=o(this.elements),n=r.next();!n.done;n=r.next()){n.value.resize(this)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.append=function(e){var t,r;this.elements.push(e);try{for(var n=o(e.getElements()),u=n.next();!u.done;u=n.next()){var i=u.value;this.svg.appendChild(i)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.getElements=function(){return this.elements},e.prototype.getLabels=function(){return this.getElements().map((function(e){return e.getLabel()}))},e.prototype.remove=function(e){var t=this;this.elements.find((function(r,n){var u,i;if(r.getAnchorElement()===e.getAnchorElement()){try{for(var s=o(e.getElements()),a=s.next();!a.done;a=s.next()){a.value.remove()}}catch(e){u={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(u)throw u.error}}return t.elements.splice(n,1),!0}}))},e.prototype.setMaxOcclusions=function(e){this.maxOcclusions=e},e.prototype.getNextNum=function(e){var t=e.altKey?0:1,r=Math.max(1,function(e){var t,r,n=0;try{for(var u=o(e),i=u.next();!i.done;i=u.next()){var s=i.value.match(x);if(s){var a=Number(s[2]);Number.isNaN(a)||(n=Math.max(n,a))}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return n}(this.getLabels())+t);return r>this.maxOcclusions?0:r},e.prototype.cleanup=function(){var e=this.container.removeChild(this.image);this.container.replaceWith(e)},e}(),or=function(){function e(e,t,r,n,o){this.scaleFactorX=1,this.scaleFactorY=1,this.container=e,this.rect=t,this.label=r,this.setScaleFactors(n,o)}return e.make=function(t){var r=document.createElementNS(rr,"svg"),n=document.createElementNS(rr,"rect"),o=document.createElementNS(rr,"text");r.appendChild(n),r.appendChild(o),r.classList.add("closet-occlusion-container__shape"),r.classList.add("closet-occlusion-container__rect"),r.tabIndex=-1;var i=u(t?t.scaleFactors:[1,1],2),s=new e(r,n,o,i[0],i[1]);return s.x=0,s.y=0,s.width=0,s.height=0,s.fill="moccasin",s.stroke="olive",s.strokeWidth=2,s},e.wrap=function(t,r){var n=u(r?r.scaleFactors:[1,1],2),o=n[0],i=n[1];return new e(t.parentElement,t,t.nextSibling,o,i)},e.prototype.prop=function(e,t){this[e]=t},e.prototype.remove=function(){this.container.remove()},e.prototype.getElements=function(){return[this.container]},e.prototype.getAnchorElement=function(){return this.rect},e.prototype.setScaleFactors=function(e,t){this.scaleFactorX=e,this.scaleFactorY=t},e.prototype.readjust=function(e){var t=e?e.scaleFactors:[1,1],r=this.scaleFactorX,n=this.scaleFactorY;return this.setScaleFactors(t[0],t[1]),[r,n]},e.prototype.resize=function(e){var t=this.pos;this.readjust(e),this.pos=t},e.prototype.toDefinition=function(){return["rect",void 0,this.labelText,this.x,this.y,this.width,this.height,{}]},e.prototype.toText=function(e){return""+e.open+this.labelText+e.sep+this.x.toFixed()+","+this.y.toFixed()+","+this.width.toFixed()+","+this.height.toFixed()+e.close},e.prototype.fontSizeUpdate=function(){var e=u(this.readjust(),2),t=e[0],r=e[1],n=Math.max(.1,Math.min(32,.4*((this.width+this.height)/2-2*this.strokeWidth)));this.fontSize=n,this.setScaleFactors(t,r)},Object.defineProperty(e.prototype,"pos",{get:function(){return[this.x,this.y,this.width,this.height]},set:function(e){var t=u(e,4),r=t[0],n=t[1],o=t[2],i=t[3];this.width=o,this.height=i,this.x=r,this.y=n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaled",{get:function(){return[Number(this.rect.getAttributeNS(null,"x")),Number(this.rect.getAttributeNS(null,"y")),Number(this.rect.getAttributeNS(null,"width")),Number(this.rect.getAttributeNS(null,"height"))]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return Number(this.rect.getAttributeNS(null,"x"))/this.scaleFactorX},set:function(e){var t=e*this.scaleFactorX;this.rect.setAttributeNS(null,"x",String(t)),this.label.setAttributeNS(null,"x",String(t+this.width/2*this.scaleFactorX))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return Number(this.rect.getAttributeNS(null,"y"))/this.scaleFactorY},set:function(e){var t=e*this.scaleFactorY;this.rect.setAttributeNS(null,"y",String(t)),this.label.setAttributeNS(null,"y",String(t+this.height/2*this.scaleFactorY))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Number(this.rect.getAttributeNS(null,"width"))/this.scaleFactorX},set:function(e){var t=String(Math.max(10,e)*this.scaleFactorX);this.rect.setAttributeNS(null,"width",t),this.label.setAttributeNS(null,"width",t),this.fontSizeUpdate()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Number(this.rect.getAttributeNS(null,"height"))/this.scaleFactorY},set:function(e){var t=String(Math.max(10,e)*this.scaleFactorY);this.rect.setAttributeNS(null,"height",t),this.label.setAttributeNS(null,"height",t),this.fontSizeUpdate()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rx",{get:function(){return Number(this.rect.getAttributeNS(null,"rx"))},set:function(e){this.rect.setAttributeNS(null,"rx",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ry",{get:function(){return Number(this.rect.getAttributeNS(null,"ry"))},set:function(e){this.rect.setAttributeNS(null,"ry",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){var e;return null!==(e=this.rect.getAttributeNS(null,"fill"))&&void 0!==e?e:""},set:function(e){this.rect.setAttributeNS(null,"fill",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillOpacity",{get:function(){return Number(this.rect.getAttributeNS(null,"fill-opacity"))},set:function(e){this.rect.setAttributeNS(null,"fill-opacity",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stroke",{get:function(){var e;return null!==(e=this.rect.getAttributeNS(null,"stroke"))&&void 0!==e?e:""},set:function(e){this.rect.setAttributeNS(null,"stroke",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strokeOpacity",{get:function(){return Number(this.rect.getAttributeNS(null,"stroke-opacity"))},set:function(e){this.rect.setAttributeNS(null,"stroke-opacity",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strokeWidth",{get:function(){return Number(this.rect.getAttributeNS(null,"stroke-width"))},set:function(e){this.rect.setAttributeNS(null,"stroke-width",String(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"labelText",{get:function(){return this.label.innerHTML},set:function(e){this.label.innerHTML=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return Number(this.label.getAttributeNS(null,"font-size"))},set:function(e){this.label.setAttributeNS(null,"font-size",String(e))},enumerable:!1,configurable:!0}),e.prototype.getLabel=function(){return this.labelText},e}(),ur=function(e,t,r,n,o,i,s,a){return function(c){var l=u(e(Zt(c)),2),p=l[0],f=l[1];r&&p<s?(t.x=p,t.width=s-p):n&&(t.x=s,t.width=p-s),o&&f<a?(t.y=f,t.height=a-f):i&&(t.y=a,t.height=f-a)}},ir=function(e,t,r,n,o,i,s,a,c){return function(l,p,f){var h=u(l.scaled,4),d=h[0],m=h[1],v=d+h[2]-p,y=f-m,g=m+h[3]-f;return p-d<=5?y<=5?e(l):g<=5?t(l):r(l):v<=5?y<=5?n(l):g<=5?o(l):i(l):y<=5?s(l):g<=5?a(l):c(l)}},sr=ir((function(e){return[!0,!1,!0,!1,e.x+e.width,e.y+e.height]}),(function(e){return[!0,!1,!1,!0,e.x+e.width,e.y]}),(function(e){return[!0,!1,!1,!1,e.x+e.width,0]}),(function(e){return[!1,!0,!0,!1,e.x,e.y+e.height]}),(function(e){return[!1,!0,!1,!0,e.x,e.y]}),(function(e){return[!1,!0,!1,!1,e.x,0]}),(function(e){return[!1,!1,!0,!1,0,e.y+e.height]}),(function(e){return[!1,!1,!1,!0,0,e.y]}),(function(){return[!1,!1,!1,!1,0,0]})),ar=ir((function(){return"nwse-resize"}),(function(){return"nesw-resize"}),(function(){return"ew-resize"}),(function(){return"nesw-resize"}),(function(){return"nwse-resize"}),(function(){return"ew-resize"}),(function(){return"ns-resize"}),(function(){return"ns-resize"}),(function(){return"move"})),cr=function(e){return function(t){var r=u(t,2),n=r[0],o=r[1];return function(e){return function(t){var r=u(t,2),n=r[0],o=r[1],i=e.getPropertyValue("zoom"),s=Number(i);return Number.isNaN(s)||s<=0?[n,o]:[n/s,o/s]}}(e)([n,o])}},lr=function(e){var t=document.createElement("li"),r=document.createElement("a");return e.html?r.innerHTML=e.label:r.innerText=e.label,r.id=e.itemId,r.classList.add("context-menu-item"),e.clickEvent&&r.addEventListener("click",e.clickEvent),t.appendChild(r),e.sub&&e.sub.length>0&&t.appendChild(pr(e.sub)),t},pr=function(e){var t,r,n=document.createElement("ul"),u=e.map(lr);try{for(var i=o(u),s=i.next();!s.done;s=i.next()){var a=s.value;n.appendChild(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n},fr=function(e){return function(t){e.classList.remove("context-menu--active")}},hr=function(e,t){var r=fr(e);t.addEventListener("contextmenu",(function(t){t.preventDefault(),t.stopPropagation(),document.querySelectorAll(".context-menu--active").forEach((function(e){return e.classList.remove("context-menu--active")})),e.classList.add("context-menu--active"),window.addEventListener("click",r,{once:!0}),function(e,t,r){e.style.left=t+"px",e.style.top=r+"px"}(e,t.pageX,t.pageY)}))},dr=function(e,t){var r,n,o,u=(r=e,n=t,(o=document.createElement("nav")).classList.add("context-menu"),o.id=r,o.appendChild(pr(n)),o);return document.body.insertAdjacentElement("beforeend",u),function(e){e.addEventListener("click",(function(e){e.stopPropagation()})),e.querySelectorAll("li").forEach((function(t){t.addEventListener("mouseenter",(function(){t.classList.add("context-menu--hover")})),t.addEventListener("mouseleave",(function(){t.classList.remove("context-menu--hover")})),t.addEventListener("click",(function(t){fr(e)(t)}))}))}(u),u},mr=function(e,t){var r=t.template,n=t.cache,i=t.environment,s=r.textFragments.flatMap(Vt),a=n.get(e.keyword,[]);i.post("occlusionSvgCss",(function(){return!0}),!1)||Wt(tr),er('img[src="'+s[0]+'"]',(function(e){var t,r,n=nr.wrapImage(e.target);try{for(var i=o(a),s=i.next();!s.done;s=i.next()){var c=u(s.value,8),l=c[1],p=c[3],f=c[4],h=c[5],d=c[6],m=c[7];if(l){var v=or.make(n);for(var y in v.pos=[p,f,h,d],m){var g=y;v.prop(g,m[g])}n.append(v)}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}))},vr=function(e,t){void 0===t&&(t={});var r={};return e.map((function(e){return e.split("=")})).forEach((function(e){var t=u(e,2),n=t[0],o=t[1];return r[n]=o})),Object.assign(r,t)},yr=function(e){return function(t,r){var n=t.fullKey,o=t.values,i=r.cache,s=r.aftermath,a=u(o),c=a[0],l=void 0===c?0:c,p=a[1],f=void 0===p?0:p,h=a[2],d=void 0===h?50:h,m=a[3],v=void 0===m?d:m,y=a.slice(4);return i.over("occlusionRenderRect",(function(t){return t.push(["rect",!0,n,Number(l),Number(f),Number(d),Number(v),vr(y,e)])}),[]),s.registerIfNotExists("occlusionRenderRect",mr),{ready:!0}}},gr=bt((function(e,t){return function(r){void 0===r&&(r={});var n={fill:"transparent",stroke:"transparent"},o=r.tagname,u=void 0===o?"rect":o,i=r.front,s=void 0===i?yr:i,a=r.back,c=void 0===a?yr:a,l=r.separator,p=void 0===l?{sep:","}:l,f=r.flashcardTemplate,h=void 0===f?yt():f,d=r.frontProperties,m=void 0===d?{fill:"salmon",stroke:"yellow"}:d,v=r.backProperties,y=void 0===v?n:v,g=r.contextProperties,b=void 0===g?{}:g,x={separators:[p]};return h(e,t)(u,s(m),c(y),yr(n),yr(b),x)}})),br=function(e,t){var r=or.wrap(t.target);if(t.shiftKey)e.remove(r);else{var n=cr(window.getComputedStyle(e.image)),o=u(n(Zt(t)),2),s=o[0],a=o[1],c=sr(r,s,a),l=c.includes(!0)?ur.apply(void 0,i([n,r],c)):function(e,t,r,n,o,i){return function(s){var a=u(e(Zt(s)),2),c=a[0],l=a[1],p=r+(c-o),f=n+(l-i);t.x=p,t.y=f}}(n,r,r.x,r.y,s,a);e.svg.addEventListener("mousemove",l),e.svg.addEventListener("mouseup",(function(t){t.preventDefault(),e.svg.removeEventListener("mousemove",l)}),{once:!0})}},xr=function(e,t){var r=cr(window.getComputedStyle(e.image));t.rect.addEventListener("mousemove",function(e,t){return function(r){if(r.shiftKey)t.rect.style.cursor="no-drop";else{var n=u(e(Zt(r)),2),o=n[0],i=n[1],s=ar(t,o,i);t.rect.style.cursor=s}}}(r,t));var n=dr("occlusion-shape-menu",[{label:"Change Label",itemId:"change-label",clickEvent:function(){var e=prompt("Specify the new label",t.labelText);"string"==typeof e&&(t.labelText=e)}},{label:"Close Menu",itemId:"close-occlusion-menu"}]);hr(n,t.rect),e.append(t)},Ar=function(e,t){var r=cr(window.getComputedStyle(e.image)),n=u(r(Zt(t)),2),o=n[0],i=n[1],s=or.make(),a=e.getNextNum(t);s.labelText="rect"+a,s.pos=[o,i,0,0],xr(e,s);var c=ur(r,s,!0,!0,!0,!0,o,i);e.svg.addEventListener("mousemove",c),e.svg.addEventListener("mouseup",(function(){e.svg.removeEventListener("mousemove",c),s.readjust(e)}))},wr=function(e,t){e.svg.addEventListener("mousedown",(function(t){0===t.button&&function(e,t){t.preventDefault(),("svg"!==t.target.nodeName?br:Ar)(e,t)}(e,t)})),hr(t,e.svg)},Er=function(e,t){return function(e){navigator.clipboard.writeText(e.map((function(e){return e.toText(t.template.parser.delimiters)})).join("\n")).catch((function(){return console.log("Window needs active focus for copying to clipboard")}))}},Fr=function(){return function(e,t){return t.cleanup()}},kr={occlusionEditor:function(e){return void 0===e&&(e={}),function(t){var r="makeOcclusions",n=new EventTarget,s=e.tagname,a=void 0===s?r:s,c=e.maxOcclusions,l=void 0===c?500:c,p=e.acceptHandler,f=void 0===p?Er:p,h=e.rejectHandler,d=void 0===h?Fr:h,m=e.setupOcclusionMenu,v=void 0===m?me:m,y=e.existingShapesFilter,g=void 0===y?function(){return me}:y,b=e.shapeKeywords,x=void 0===b?["occlusionRenderRect"]:b;return t.register(a,(function(e,t){var s=t.template.textFragments.flatMap(Vt);return t.aftermath.registerIfNotExists(r,(function(e,t){var r,a,c,p;t.environment.post("occlusionMakerCss",(function(){return!0}),!1)||(Wt("\n:root {\n  --cm-niceblue: #3f8cf1;\n  --cm-nicegray: #444;\n  --cm-backgray: #ececec;\n  --cm-boxgray: #cfcfcf;\n}\n\nnav.context-menu {\n  position: absolute;\n  z-index: 9999;\n  display: none;\n}\n\nnav.context-menu--active {\n  display: block;\n}\n\n/******************** UL */\n\nnav.context-menu ul {\n  position: absolute;\n\n  padding: 0.2rem 0;\n  width: 10rem;\n\n  white-space: nowrap;\n  list-style: none;\n\n  background-color: var(--cm-backgray);\n  border: solid 1px var(--cm-boxgray);\n  box-shadow: 1px 1px 2px var(--cm-boxgray);\n}\n\n/******************** LI */\n\nnav.context-menu li {\n  margin-bottom: 2px;\n}\n\nnav.context-menu li.context-menu--hover {\n  background-color: var(--cm-niceblue);\n}\n\nnav.context-menu li:last-child {\n  margin-bottom: 0;\n}\n\nnav.context-menu li ul {\n  display: none;\n  margin-left: 2rem;\n}\n\nnav.context-menu li.context-menu--hover ul {\n  display: block;\n}\n\nnav.context-menu li li ul {\n  display: none;\n  margin-left: 4rem;\n}\n\nnav.context-menu li li.context-menu--hover ul {\n  display: block;\n}\n\n/******************** A */\n\nnav.context-menu a {\n  display: block;\n  padding: 0.3rem 1rem;\n  user-select: none;\n\n  color: var(--cm-nicegray);\n}\n\nnav.context-menu li.context-menu--hover a {\n  color: white;\n}\n"),Wt("\n.closet-occlusion-container {\n  outline: 3px dotted hotpink;\n}")),t.environment.post("occlusionSvgCss",(function(){return!0}),!1)||Wt(tr);var h=[];try{for(var m=o(x),y=m.next();!y.done;y=m.next()){var b=y.value,A=t.cache.get(b,[]);h.push.apply(h,i(A)),t.aftermath.block(b)}}catch(e){r={error:e}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(r)throw r.error}}var w=function(r){var o=nr.wrapImage(r.target);o.setMaxOcclusions(l),g(e,t)(h,o).forEach((function(e){return function(e,t){var r,n=null,o=null,i=null,s=null,a=null,c=null,l=u(t),p=l[0],f=l.slice(2);switch(p){case"rect":n=(r=u(f,5))[0],o=r[1],i=r[2],s=r[3],a=r[4],(c=or.make(e)).labelText=n,c.pos=[o,i,s,a],xr(e,c)}}(o,e)}));n.addEventListener("accept",(function(){f(e,t)(o.getElements(),o)})),n.addEventListener("reject",(function(){d(e,t)(o.getElements(),o)}));var i=function(e,t){var r=t([{label:"Accept occlusions",itemId:"occlusion-accept",clickEvent:function(t){t.preventDefault(),e.dispatchEvent(new Event("accept"))}},{label:"Close Menu",itemId:"close-occlusion-menu"}]);return dr("occlusion-menu",r)}(n,v);wr(o,i)};try{for(var E=o(s),F=E.next();!F.done;F=E.next()){var k=F.value;er('img[src="'+k+'"]',w)}}catch(e){c={error:e}}finally{try{F&&!F.done&&(p=E.return)&&p.call(E)}finally{if(c)throw c.error}}}),{priority:100}),{ready:!0}})),n}},rect:gr},Sr={appendStyleTag:Wt,recipes:kr},Cr=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!globalThis.closetDebug)return!1;var r=Object.assign(document.createElement("div"),{className:"closet-log",innerText:e.map(String).join("\n")}),n=document.getElementById("qa");return!!n&&(n.appendChild(r),!0)},Br="github.com/hgiesel/closet",Dr=function(){function e(){this._isAvailable=!1;try{"object"==typeof globalThis.sessionStorage&&(this._isAvailable=!0)}catch(e){}}return e.prototype.clear=function(){for(var e=0;e<sessionStorage.length;e++){var t=sessionStorage.key(e);t&&0===t.indexOf(Br)&&(sessionStorage.removeItem(t),e--)}},e.prototype.setItem=function(e,t){sessionStorage.setItem(Br+e,JSON.stringify(t))},e.prototype.getItem=function(e){var t,r=null!==(t=sessionStorage.getItem(Br+e))&&void 0!==t?t:"null";return JSON.parse(r)},e.prototype.removeItem=function(e){sessionStorage.removeItem(Br+e)},e.prototype.isAvailable=function(){return this._isAvailable},e}(),Nr=function(){function e(e){this._isAvailable=!1,this.obj=globalThis[e],"object"==typeof this.obj&&(this._isAvailable=!0,void 0===this.obj[Br]&&this.clear())}return e.prototype.clear=function(){this.obj[Br]={}},e.prototype.setItem=function(e,t){this.obj[Br][e]=t},e.prototype.getItem=function(e){return null==this.obj[Br][e]?null:this.obj[Br][e]},e.prototype.removeItem=function(e){delete this.obj[Br][e]},e.prototype.isAvailable=function(){return this._isAvailable},e}(),$r=function(){var e;if((e=new Dr).isAvailable())return Cr("Used Persistence sessionStorage implementation"),e;if((e=new Nr("py")).isAvailable())return Cr("Used Persistence windowKey py implementation"),e;var t=location.toString().indexOf("title"),r=location.toString().indexOf("main",t);return t>0&&r>0&&r-t<10?(Cr("Used Persistence windowKey qt implementation"),new Nr("qt")):(Cr("Defaulted to Persistence windowKey implementation"),e)}();!function(e){e[e.ClosetImmediately=1]="ClosetImmediately",e[e.DesktopShownHook=2]="DesktopShownHook",e[e.MobileMathJax=3]="MobileMathJax",e[e.DesktopMobileLate=4]="DesktopMobileLate",e[e.Web=5]="Web"}(pe||(pe={}));var Ir=function(e){switch(e){case pe.ClosetImmediately:return"You have set the variable globalThis.closetImmediately.";case pe.DesktopShownHook:return"Closet executes while MathJax is still rendering. You are on AnkiDesktop. The action will be pushed onto onShownHook.";case pe.MobileMathJax:return"Closet executes while MathJax is still rendering. You are on AnkiMobile. The action will be enqueued on MathJax.Hub.Queue.";case pe.DesktopMobileLate:return"Closet executes after MathJax finished rendering. The action will be executed immediatley.";case pe.Web:return"You are on AnkiWeb, which does not have MathJax. Alternatively, you are on platform with MathJax 3. The action will be executed immediatley.";default:return"No Description found. This should never happen."}},Or={raw:function(e){return e()},viaShownHook:function(e){return globalThis.onShownHook.push(e)},viaMathJaxQueue:function(e){return globalThis.MathJax.Hub.Queue(e)}},Tr=function(){var e=globalThis.MathJax.Hub.queue,t=Object.assign({},e);return t.queue=t.queue.map(String),t},jr=function(e){var t=u(function(){if(globalThis.closetImmediately)return[Or.raw,pe.ClosetImmediately,[]];try{var e=globalThis._updatingQA,t=Tr();if(e){var r=globalThis.onShownHook;return r?[Or.viaShownHook,pe.DesktopShownHook,[JSON.stringify(r.map(String)),JSON.stringify(t)]]:[Or.viaMathJaxQueue,pe.MobileMathJax,[JSON.stringify(t)]]}return[Or.raw,pe.DesktopMobileLate,[JSON.stringify(t)]]}catch(e){return[Or.raw,pe.Web,[e]]}}(),3),r=t[0],n=t[1],o=t[2];Cr.apply(void 0,i(["Init mode "+n,Ir(n)],o)),r(e)},_r=function(e,t,r,n){var o=window.performance.now();return G.makeFromNodes(e,null==n?void 0:n.delimiters).renderToNodes(r),t.writeBack(),window.performance.now()-o},Pr=function(e,t,r,n,o){var u,s;return t(e,function(e,t,r){return{card:e,cardNumber:(n=e,Number(n.match(/[0-9]*$/))),tagsFull:t,tags:0===t.length?[]:t.split(" "),side:r};var n}(r,n,o),function(e,t){return function(r){var n,o=null!==(n=globalThis.closetCardHash)&&void 0!==n?n:null,u=function(){if(!$r.isAvailable())return new Map;if("front"===e){var n=function(e){var t,r=0;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}(t);if(n!==o)return globalThis.closetCardHash=n,new Map}var u=$r.getItem(r);return new Map(u)}();return{key:r,map:u,writeBack:function(){if($r.isAvailable()){var e=Array.from(u.entries());$r.setItem(r,e)}}}}}(o,null!==(s=null===(u=document.getElementById("qa"))||void 0===u?void 0:u.innerHTML)&&void 0!==s?s:"")).map((function(e){return _r.apply(void 0,i(e))}))},Mr=Object.freeze({__proto__:null,init:Pr,initialize:function(e,t,r,n,o){return jr((function(){return function(e,t,r,n,o){try{var u=Pr(e,t,r,n,o);console.log("Closet executed in "+u.map((function(e){return e.toFixed(3)}))+"ms.")}catch(e){console.log("An error occured while executing Closet:",e),Cr("An error occured while executing Closet",e)}finally{R()}}(e,t,r,n,o)})),e},ankiLog:Cr,getQaChildNodes:function(){if(!window.document)return null;var e=window.document.getElementById("qa");return e?function(e,t){for(var r=[],n=new(L.bind.apply(L,i([void 0,e],z(t))));n.valid;)r.push(n),n=new(L.bind.apply(L,i([void 0,e],z(t,n.to+1))));return r}(e,{type:"predicate",value:function(e){return!(function(e){return e.nodeType===Node.ELEMENT_NODE}(e)&&(function(e){return"STYLE"===e.tagName}(e)||function(e){return function(e){return"SCRIPT"===e.tagName}(e)&&(0===e.type.length||e.type.endsWith("javascript"))}(e)||function(e){return"anki-am"===e.id}(e)))}}):null}}),Lr=r(r({},Sr),{cleanup:R});export{G as BrowserTemplate,oe as FilterManager,O as Parser,Ee as Stylizer,de as TagSelector,T as Template,Mr as anki,Lr as browser,ft as deciders,C as keyPattern,x as keySeparationPattern,a as prereleaseInfo,Kt as recipes,Ut as sequencers,Ae as unicodeAlphanumericPattern,be as unicodeLetterPattern,xe as unicodeNumberPattern,c as version,s as versionInfo,Xt as wrappers};